{"version":3,"file":"EnvelopeFactory.js","sourceRoot":"","sources":["../../Library/EnvelopeFactory.ts"],"names":[],"mappings":"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","sourcesContent":["import Contracts = require(\"../Declarations/Contracts\")\nimport Util = require(\"./Util\")\nimport Config = require(\"./Config\");\nimport Context = require(\"./Context\");\nimport { CorrelationContextManager } from \"../AutoCollection/CorrelationContextManager\";\n\n\n/**\n * Manages the logic of creating envelopes from Telemetry objects\n */\nclass EnvelopeFactory {\n\n\n    /**\n     * Creates envelope ready to be sent by Channel\n     * @param telemetry Telemetry data\n     * @param telemetryType Type of telemetry\n     * @param commonProperties Bag of custom common properties to be added to the envelope\n     * @param context Client context\n     * @param config Client configuration\n     */\n    public static createEnvelope(\n        telemetry: Contracts.Telemetry,\n        telemetryType: Contracts.TelemetryType,\n        commonProperties?: { [key: string]: string; },\n        context?: Context,\n        config?: Config): Contracts.Envelope {\n\n        var data = null;\n\n\n        switch (telemetryType) {\n            case Contracts.TelemetryType.Trace:\n                data = EnvelopeFactory.createTraceData(<Contracts.TraceTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Dependency:\n                data = EnvelopeFactory.createDependencyData(<Contracts.DependencyTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Event:\n                data = EnvelopeFactory.createEventData(<Contracts.EventTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Exception:\n                data = EnvelopeFactory.createExceptionData(<Contracts.ExceptionTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Request:\n                data = EnvelopeFactory.createRequestData(<Contracts.RequestTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Metric:\n                data = EnvelopeFactory.createMetricData(<Contracts.MetricTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.Availability:\n                data = EnvelopeFactory.createAvailabilityData(<Contracts.AvailabilityTelemetry>telemetry);\n                break;\n            case Contracts.TelemetryType.PageView:\n                data = EnvelopeFactory.createPageViewData(<Contracts.PageViewTelemetry>telemetry);\n                break;\n        }\n\n        if (commonProperties && Contracts.domainSupportsProperties(data.baseData)) { // Do instanceof check. TS will automatically cast and allow the properties property\n            if (data && data.baseData) {\n                // if no properties are specified just add the common ones\n                if (!data.baseData.properties) {\n                    data.baseData.properties = commonProperties;\n                } else {\n                    // otherwise, check each of the common ones\n                    for (var name in commonProperties) {\n                        // only override if the property `name` has not been set on this item\n                        if (!data.baseData.properties[name]) {\n                            data.baseData.properties[name] = commonProperties[name];\n                        }\n                    }\n                }\n            }\n\n            // sanitize properties\n            data.baseData.properties = Util.validateStringMap(data.baseData.properties);\n        }\n\n        var iKey = config ? config.instrumentationKey || \"\" : \"\";\n        var envelope = new Contracts.Envelope();\n        envelope.data = data;\n        envelope.iKey = iKey;\n\n        // this is kind of a hack, but the envelope name is always the same as the data name sans the chars \"data\"\n        envelope.name =\n            \"Microsoft.ApplicationInsights.\" +\n            iKey.replace(/-/g, \"\") +\n            \".\" +\n            data.baseType.substr(0, data.baseType.length - 4);\n        envelope.tags = this.getTags(context, telemetry.tagOverrides);\n        envelope.time = (new Date()).toISOString();\n        envelope.ver = 1;\n        envelope.sampleRate = config ? config.samplingPercentage : 100;\n\n        // Exclude metrics from sampling by default\n        if (telemetryType === Contracts.TelemetryType.Metric) {\n            envelope.sampleRate = 100;\n        }\n\n        return envelope;\n    }\n\n    private static createTraceData(telemetry: Contracts.TraceTelemetry): Contracts.Data<Contracts.MessageData> {\n        var trace = new Contracts.MessageData();\n        trace.message = telemetry.message;\n        trace.properties = telemetry.properties;\n        if (!isNaN(telemetry.severity)) {\n            trace.severityLevel = telemetry.severity;\n        } else {\n            trace.severityLevel = Contracts.SeverityLevel.Information;\n        }\n\n        var data = new Contracts.Data<Contracts.MessageData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Trace);\n        data.baseData = trace;\n        return data;\n    }\n\n    private static createDependencyData(telemetry: Contracts.DependencyTelemetry & Contracts.Identified): Contracts.Data<Contracts.RemoteDependencyData> {\n        var remoteDependency = new Contracts.RemoteDependencyData();\n        if (typeof telemetry.name === \"string\") {\n            remoteDependency.name = telemetry.name.length > 1024 ? telemetry.name.slice(0, 1021) + '...' : telemetry.name;\n        }\n        remoteDependency.data = telemetry.data;\n        remoteDependency.target = telemetry.target;\n        remoteDependency.duration = Util.msToTimeSpan(telemetry.duration);\n        remoteDependency.success = telemetry.success;\n        remoteDependency.type = telemetry.dependencyTypeName;\n        remoteDependency.properties = telemetry.properties;\n        remoteDependency.resultCode = (telemetry.resultCode ? telemetry.resultCode + '' : '');\n\n        if (telemetry.id) {\n            remoteDependency.id = telemetry.id;\n        }\n        else {\n            remoteDependency.id = Util.w3cTraceId();\n        }\n\n        var data = new Contracts.Data<Contracts.RemoteDependencyData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Dependency);\n        data.baseData = remoteDependency;\n        return data;\n    }\n\n    private static createEventData(telemetry: Contracts.EventTelemetry): Contracts.Data<Contracts.EventData> {\n        var event = new Contracts.EventData();\n        event.name = telemetry.name;\n        event.properties = telemetry.properties;\n        event.measurements = telemetry.measurements;\n\n        var data = new Contracts.Data<Contracts.EventData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Event);\n        data.baseData = event;\n        return data;\n    }\n\n    private static createExceptionData(telemetry: Contracts.ExceptionTelemetry): Contracts.Data<Contracts.ExceptionData> {\n        var exception = new Contracts.ExceptionData();\n        exception.properties = telemetry.properties;\n        if (!isNaN(telemetry.severity)) {\n            exception.severityLevel = telemetry.severity;\n        } else {\n            exception.severityLevel = Contracts.SeverityLevel.Error;\n        }\n        exception.measurements = telemetry.measurements;\n        exception.exceptions = [];\n\n        var stack = telemetry.exception[\"stack\"];\n        var exceptionDetails = new Contracts.ExceptionDetails();\n        exceptionDetails.message = telemetry.exception.message;\n        exceptionDetails.typeName = telemetry.exception.name;\n        exceptionDetails.parsedStack = this.parseStack(stack);\n        exceptionDetails.hasFullStack = Util.isArray(exceptionDetails.parsedStack) && exceptionDetails.parsedStack.length > 0;\n        exception.exceptions.push(exceptionDetails);\n\n        var data = new Contracts.Data<Contracts.ExceptionData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Exception);\n        data.baseData = exception;\n        return data;\n    }\n\n    private static createRequestData(telemetry: Contracts.RequestTelemetry & Contracts.Identified): Contracts.Data<Contracts.RequestData> {\n        var requestData = new Contracts.RequestData();\n        if (telemetry.id) {\n            requestData.id = telemetry.id;\n        }\n        else {\n            requestData.id = Util.w3cTraceId();\n        }\n        requestData.name = telemetry.name;\n        requestData.url = telemetry.url;\n        requestData.source = telemetry.source;\n        requestData.duration = Util.msToTimeSpan(telemetry.duration);\n        requestData.responseCode = (telemetry.resultCode ? telemetry.resultCode + '' : '');\n        requestData.success = telemetry.success\n        requestData.properties = telemetry.properties;\n\n        var data = new Contracts.Data<Contracts.RequestData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Request);\n        data.baseData = requestData;\n        return data;\n    }\n\n    private static createMetricData(telemetry: Contracts.MetricTelemetry): Contracts.Data<Contracts.MetricData> {\n        var metrics = new Contracts.MetricData(); // todo: enable client-batching of these\n        metrics.metrics = [];\n\n        var metric = new Contracts.DataPoint();\n        metric.count = !isNaN(telemetry.count) ? telemetry.count : 1;\n        metric.kind = Contracts.DataPointType.Aggregation;\n        metric.max = !isNaN(telemetry.max) ? telemetry.max : telemetry.value;\n        metric.min = !isNaN(telemetry.min) ? telemetry.min : telemetry.value;\n        metric.name = telemetry.name;\n        metric.stdDev = !isNaN(telemetry.stdDev) ? telemetry.stdDev : 0;\n        metric.value = telemetry.value;\n\n        metrics.metrics.push(metric);\n\n        metrics.properties = telemetry.properties;\n\n        var data = new Contracts.Data<Contracts.MetricData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Metric);\n        data.baseData = metrics;\n        return data;\n    }\n\n    private static createAvailabilityData(\n        telemetry: Contracts.AvailabilityTelemetry & Contracts.Identified,\n    ): Contracts.Data<Contracts.AvailabilityData> {\n        let availabilityData = new Contracts.AvailabilityData();\n\n        if (telemetry.id) {\n            availabilityData.id = telemetry.id;\n        } else {\n            availabilityData.id = Util.w3cTraceId();\n        }\n        availabilityData.name = telemetry.name;\n        availabilityData.duration = Util.msToTimeSpan(telemetry.duration);\n        availabilityData.success = telemetry.success;\n        availabilityData.runLocation = telemetry.runLocation;\n        availabilityData.message = telemetry.message;\n        availabilityData.measurements = telemetry.measurements;\n        availabilityData.properties = telemetry.properties;\n\n        let data = new Contracts.Data<Contracts.AvailabilityData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.Availability);\n        data.baseData = availabilityData;\n\n        return data;\n    }\n\n    private static createPageViewData(\n        telemetry: Contracts.PageViewTelemetry & Contracts.Identified,\n    ): Contracts.Data<Contracts.PageViewData> {\n        let pageViewData = new Contracts.PageViewData();\n\n        pageViewData.name = telemetry.name;\n        pageViewData.duration = Util.msToTimeSpan(telemetry.duration);\n        pageViewData.url = telemetry.url;\n        pageViewData.measurements = telemetry.measurements;\n        pageViewData.properties = telemetry.properties;\n\n        let data = new Contracts.Data<Contracts.PageViewData>();\n        data.baseType = Contracts.telemetryTypeToBaseType(Contracts.TelemetryType.PageView);\n        data.baseData = pageViewData;\n\n        return data;\n    }\n\n    private static getTags(context: Context, tagOverrides?: { [key: string]: string; }) {\n        var correlationContext = CorrelationContextManager.getCurrentContext();\n\n        // Make a copy of context tags so we don't alter the actual object\n        // Also perform tag overriding\n        var newTags = <{ [key: string]: string }>{};\n\n        if (context && context.tags) {\n            for (var key in context.tags) {\n                newTags[key] = context.tags[key];\n            }\n        }\n        if (tagOverrides) {\n            for (var key in tagOverrides) {\n                newTags[key] = tagOverrides[key];\n            }\n        }\n\n        // Fill in internally-populated values if not already set\n        if (correlationContext) {\n            newTags[context.keys.operationId] = newTags[context.keys.operationId] || correlationContext.operation.id;\n            newTags[context.keys.operationName] = newTags[context.keys.operationName] || correlationContext.operation.name;\n            newTags[context.keys.operationParentId] = newTags[context.keys.operationParentId] || correlationContext.operation.parentId;\n        }\n\n        return newTags;\n    }\n\n\n    private static parseStack(stack: any): _StackFrame[] {\n        var parsedStack: _StackFrame[] = undefined;\n        if (typeof stack === \"string\") {\n            var frames = stack.split(\"\\n\");\n            parsedStack = [];\n            var level = 0;\n\n            var totalSizeInBytes = 0;\n            for (var i = 0; i <= frames.length; i++) {\n                var frame = frames[i];\n                if (_StackFrame.regex.test(frame)) {\n                    var parsedFrame = new _StackFrame(frames[i], level++);\n                    totalSizeInBytes += parsedFrame.sizeInBytes;\n                    parsedStack.push(parsedFrame);\n                }\n            }\n\n            // DP Constraint - exception parsed stack must be < 32KB\n            // remove frames from the middle to meet the threshold\n            var exceptionParsedStackThreshold = 32 * 1024;\n            if (totalSizeInBytes > exceptionParsedStackThreshold) {\n                var left = 0;\n                var right = parsedStack.length - 1;\n                var size = 0;\n                var acceptedLeft = left;\n                var acceptedRight = right;\n\n                while (left < right) {\n                    // check size\n                    var lSize = parsedStack[left].sizeInBytes;\n                    var rSize = parsedStack[right].sizeInBytes;\n                    size += lSize + rSize;\n\n                    if (size > exceptionParsedStackThreshold) {\n\n                        // remove extra frames from the middle\n                        var howMany = acceptedRight - acceptedLeft + 1;\n                        parsedStack.splice(acceptedLeft, howMany);\n                        break;\n                    }\n\n                    // update pointers\n                    acceptedLeft = left;\n                    acceptedRight = right;\n\n                    left++;\n                    right--;\n                }\n            }\n        }\n\n        return parsedStack;\n    }\n\n}\n\nclass _StackFrame {\n\n    // regex to match stack frames from ie/chrome/ff\n    // methodName=$2, fileName=$4, lineNo=$5, column=$6\n    public static regex = /^(\\s+at)?(.*?)(\\@|\\s\\(|\\s)([^\\(\\n]+):(\\d+):(\\d+)(\\)?)$/;\n    public static baseSize = 58; //'{\"method\":\"\",\"level\":,\"assembly\":\"\",\"fileName\":\"\",\"line\":}'.length\n    public sizeInBytes = 0;\n    public level: number;\n    public method: string;\n    public assembly: string;\n    public fileName: string;\n    public line: number;\n\n    constructor(frame: string, level: number) {\n        this.level = level;\n        this.method = \"<no_method>\";\n        this.assembly = Util.trim(frame);\n        var matches = frame.match(_StackFrame.regex);\n        if (matches && matches.length >= 5) {\n            this.method = Util.trim(matches[2]) || this.method;\n            this.fileName = Util.trim(matches[4]) || \"<no_filename>\";\n            this.line = parseInt(matches[5]) || 0;\n        }\n\n        this.sizeInBytes += this.method.length;\n        this.sizeInBytes += this.fileName.length;\n        this.sizeInBytes += this.assembly.length;\n\n        // todo: these might need to be removed depending on how the back-end settles on their size calculation\n        this.sizeInBytes += _StackFrame.baseSize;\n        this.sizeInBytes += this.level.toString().length;\n        this.sizeInBytes += this.line.toString().length;\n    }\n}\n\nexport = EnvelopeFactory;\n"]}