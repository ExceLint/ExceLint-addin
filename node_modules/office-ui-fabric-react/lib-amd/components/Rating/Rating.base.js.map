{"version":3,"file":"Rating.base.js","sourceRoot":"../src/","sources":["components/Rating/Rating.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\nimport {\n  warnDeprecations,\n  initializeComponentRef,\n  classNamesFunction,\n  css,\n  format,\n  getId,\n  divProperties,\n  getNativeProps,\n} from '../../Utilities';\nimport { IProcessedStyleSet } from '../../Styling';\nimport { Icon } from '../../Icon';\nimport { FocusZone, FocusZoneDirection, IFocusZoneProps } from '../../FocusZone';\nimport { IRatingProps, RatingSize, IRatingStyleProps, IRatingStyles } from './Rating.types';\n\nconst getClassNames = classNamesFunction<IRatingStyleProps, IRatingStyles>();\n\ninterface IRatingStarProps extends React.AllHTMLAttributes<HTMLElement> {\n  fillPercentage: number;\n  disabled?: boolean;\n  readOnly?: boolean;\n  classNames: IProcessedStyleSet<IRatingStyles>;\n  icon?: string;\n}\n\nexport interface IRatingState {\n  rating: number | null | undefined;\n}\n\nconst RatingStar = (props: IRatingStarProps) => {\n  const icon = props.icon || 'FavoriteStarFill';\n  return (\n    <div className={props.classNames.ratingStar} key={props.id}>\n      <Icon className={props.classNames.ratingStarBack} iconName={icon} />\n      {!props.disabled && (\n        <Icon\n          className={props.classNames.ratingStarFront}\n          iconName={icon}\n          style={{ width: props.fillPercentage + '%' }}\n        />\n      )}\n    </div>\n  );\n};\n\nexport class RatingBase extends React.Component<IRatingProps, IRatingState> {\n  public static defaultProps: IRatingProps = {\n    min: 1,\n    max: 5,\n  };\n  private _id: string;\n  private _min: number;\n  private _labelId: string;\n  private _classNames: IProcessedStyleSet<IRatingStyles>;\n\n  constructor(props: IRatingProps) {\n    super(props);\n\n    initializeComponentRef(this);\n\n    warnDeprecations('Rating', props, { onChanged: 'onChange' });\n\n    this._id = getId('Rating');\n    this._min = this.props.allowZeroStars ? 0 : 1;\n    /* eslint-disable deprecation/deprecation */\n    if (this.props.min !== undefined && this.props.min !== 1) {\n      this._min = this.props.min;\n    }\n    /* eslint-enable deprecation/deprecation */\n    this._labelId = getId('RatingLabel');\n\n    this.state = {\n      rating: this._getInitialValue(props),\n    };\n  }\n\n  public render(): JSX.Element {\n    const {\n      disabled,\n      getAriaLabel,\n      styles,\n      max,\n      readOnly,\n      size,\n      theme,\n      icon = 'FavoriteStarFill',\n      unselectedIcon = 'FavoriteStar',\n    } = this.props;\n\n    const id = this._id;\n    const stars = [];\n    const starIds = [];\n    const rating = this._getRating();\n    const divProps = getNativeProps<React.HTMLAttributes<HTMLDivElement>>(this.props, divProperties);\n\n    this._classNames = getClassNames(styles!, {\n      disabled,\n      readOnly,\n      theme: theme!,\n    });\n\n    for (let i = this._min as number; i <= (max as number); i++) {\n      if (i !== 0) {\n        const fillPercentage = this._getFillingPercentage(i);\n        const ratingStarProps: IRatingStarProps = {\n          fillPercentage,\n          disabled,\n          classNames: this._classNames,\n          icon: fillPercentage > 0 ? icon : unselectedIcon,\n        };\n\n        starIds.push(this._getStarId(i - 1));\n\n        stars.push(\n          <button\n            className={css(this._classNames.ratingButton, {\n              [this._classNames.ratingStarIsLarge]: size === RatingSize.Large,\n              [this._classNames.ratingStarIsSmall]: size !== RatingSize.Large,\n            })}\n            id={starIds[i - 1]}\n            key={i}\n            {...(i === Math.ceil(rating) ? { 'data-is-current': true } : {})}\n            onFocus={this._onFocus.bind(this, i)}\n            onClick={this._onFocus.bind(this, i)} // For Safari & Firefox on OSX\n            disabled={disabled || readOnly ? true : false}\n            role=\"presentation\"\n            type=\"button\"\n          >\n            {this._getLabel(i)}\n            <RatingStar key={i + 'rating'} {...ratingStarProps} />\n          </button>,\n        );\n      }\n    }\n\n    const ariaLabel = getAriaLabel ? getAriaLabel(rating ? rating : 0, max as number) : undefined;\n\n    // When in read-only mode, we allow focus (per ARIA standards) and set up ARIA attributes to indicate element\n    // is read-only. https://www.w3.org/TR/wai-aria-1.1/#aria-readonly\n    const readOnlyProps: IFocusZoneProps | undefined = readOnly\n      ? ({\n          allowFocusRoot: true,\n          disabled: true,\n          'aria-label': ariaLabel,\n          'aria-readonly': true,\n          'data-is-focusable': true,\n          tabIndex: 0,\n        } as IFocusZoneProps)\n      : undefined;\n\n    return (\n      <div\n        className={css('ms-Rating-star', this._classNames.root, {\n          [this._classNames.rootIsLarge]: size === RatingSize.Large,\n          [this._classNames.rootIsSmall]: size !== RatingSize.Large,\n        })}\n        aria-label={!readOnly ? ariaLabel : ''}\n        id={id}\n        {...divProps}\n      >\n        <FocusZone\n          direction={FocusZoneDirection.horizontal}\n          className={css(this._classNames.ratingFocusZone, {\n            [this._classNames.rootIsLarge]: size === RatingSize.Large,\n            [this._classNames.rootIsSmall]: size !== RatingSize.Large,\n          })}\n          defaultActiveElement={\n            rating ? starIds[Math.ceil(rating) - 1] && '#' + starIds[Math.ceil(rating) - 1] : undefined\n          }\n          {...readOnlyProps}\n        >\n          {stars}\n        </FocusZone>\n      </div>\n    );\n  }\n\n  private _getStarId(index: number): string {\n    return this._id + '-star-' + index;\n  }\n\n  private _onFocus(value: number, ev: React.FocusEvent<HTMLElement>): void {\n    if (Math.ceil(this.state.rating!) !== value) {\n      this.setState({\n        rating: value,\n      } as IRatingState);\n\n      // eslint-disable-next-line deprecation/deprecation\n      const { onChange, onChanged } = this.props;\n\n      if (onChange) {\n        onChange(ev, value);\n      }\n\n      if (onChanged) {\n        onChanged(value);\n      }\n    }\n  }\n\n  private _getLabel(rating: number): JSX.Element {\n    const text = this.props.ariaLabelFormat || '';\n\n    return (\n      <span id={`${this._labelId}-${rating}`} className={this._classNames.labelText}>\n        {format(text, rating, this.props.max)}\n      </span>\n    );\n  }\n\n  private _getInitialValue(props: IRatingProps): number | undefined {\n    if (typeof props.rating === 'undefined') {\n      return this._min;\n    }\n\n    if (props.rating === null) {\n      return undefined;\n    }\n\n    return this._getClampedRating(props.rating);\n  }\n\n  private _getClampedRating(rating: number): number {\n    return Math.min(Math.max(rating, this._min as number), this.props.max as number);\n  }\n\n  private _getRating(): number {\n    if (this.props.rating !== undefined) {\n      return this._getClampedRating(this.props.rating);\n    }\n    if (this.state.rating !== undefined && this.state.rating !== null) {\n      return this._getClampedRating(this.state.rating);\n    }\n    return 0;\n  }\n\n  private _getFillingPercentage(starPosition: number): number {\n    const rating = this._getRating();\n    const ceilValue = Math.ceil(rating as number);\n    let fillPercentage = 100;\n\n    if (starPosition === rating) {\n      fillPercentage = 100;\n    } else if (starPosition === ceilValue) {\n      fillPercentage = 100 * ((rating as number) % 1);\n    } else if (starPosition > ceilValue) {\n      fillPercentage = 0;\n    }\n    return fillPercentage;\n  }\n}\n"]}