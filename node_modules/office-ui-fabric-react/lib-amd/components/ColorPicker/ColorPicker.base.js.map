{"version":3,"file":"ColorPicker.base.js","sourceRoot":"../src/","sources":["components/ColorPicker/ColorPicker.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { BaseComponent, classNamesFunction } from '../../Utilities';\r\nimport { IColorPickerProps, IColorPickerStyleProps, IColorPickerStyles, IColorPicker } from './ColorPicker.types';\r\nimport { TextField } from '../../TextField';\r\nimport { ColorRectangle } from './ColorRectangle/ColorRectangle';\r\nimport { ColorSlider } from './ColorSlider/ColorSlider';\r\nimport { IColor } from '../../utilities/color/interfaces';\r\nimport { MAX_COLOR_HUE } from '../../utilities/color/consts';\r\nimport { getColorFromString } from '../../utilities/color/getColorFromString';\r\nimport { getColorFromRGBA } from '../../utilities/color/getColorFromRGBA';\r\nimport { updateA } from '../../utilities/color/updateA';\r\nimport { updateH } from '../../utilities/color/updateH';\r\n\r\ntype IRGBHex = Pick<IColor, 'r' | 'g' | 'b' | 'a' | 'hex'>;\r\n\r\nexport interface IColorPickerState {\r\n  color: IColor;\r\n}\r\n\r\nconst getClassNames = classNamesFunction<IColorPickerStyleProps, IColorPickerStyles>();\r\n\r\nconst colorComponents: Array<keyof IRGBHex> = ['hex', 'r', 'g', 'b', 'a'];\r\n\r\nexport class ColorPickerBase extends BaseComponent<IColorPickerProps, IColorPickerState> implements IColorPicker {\r\n  public static defaultProps = {\r\n    hexLabel: 'Hex',\r\n    redLabel: 'Red',\r\n    greenLabel: 'Green',\r\n    blueLabel: 'Blue',\r\n    alphaLabel: 'Alpha'\r\n  };\r\n\r\n  private _textChangeHandlers: {\r\n    [K in keyof IRGBHex]: (event: React.FormEvent<HTMLInputElement | HTMLTextAreaElement>, newValue?: string) => void\r\n  };\r\n  private _textLabels: { [K in keyof IRGBHex]?: string };\r\n\r\n  constructor(props: IColorPickerProps) {\r\n    super(props);\r\n\r\n    this._warnDeprecations({\r\n      onColorChanged: 'onChange'\r\n    });\r\n\r\n    this.state = {\r\n      color: _getColorFromProps(props) || getColorFromString('#ffffff')!\r\n    };\r\n\r\n    this._textChangeHandlers = {} as any;\r\n    for (const component of colorComponents) {\r\n      this._textChangeHandlers[component] = this._onTextChange.bind(this, component);\r\n    }\r\n    this._textLabels = {\r\n      r: props.redLabel,\r\n      g: props.greenLabel,\r\n      b: props.blueLabel,\r\n      a: props.alphaLabel,\r\n      hex: props.hexLabel\r\n    };\r\n  }\r\n\r\n  public get color(): IColor {\r\n    return this.state.color;\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: IColorPickerProps): void {\r\n    const color = _getColorFromProps(newProps);\r\n    if (color) {\r\n      this._updateColor(undefined, color);\r\n    }\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const props = this.props;\r\n    const { theme, className, styles } = props;\r\n    const { color } = this.state;\r\n\r\n    const classNames = getClassNames(styles!, {\r\n      theme: theme!,\r\n      className\r\n    });\r\n\r\n    return (\r\n      <div className={classNames.root}>\r\n        <div className={classNames.panel}>\r\n          <ColorRectangle color={color} onChange={this._onSVChanged} />\r\n          <ColorSlider className=\"is-hue\" minValue={0} maxValue={MAX_COLOR_HUE} value={color.h} onChange={this._onHChanged} />\r\n          {!props.alphaSliderHidden && (\r\n            <ColorSlider\r\n              className=\"is-alpha\"\r\n              isAlpha\r\n              overlayStyle={{ background: `linear-gradient(to right, transparent 0, #${color.hex} 100%)` }}\r\n              minValue={0}\r\n              maxValue={100}\r\n              value={color.a}\r\n              onChange={this._onAChanged}\r\n            />\r\n          )}\r\n          <table className={classNames.table} cellPadding=\"0\" cellSpacing=\"0\">\r\n            <thead>\r\n              <tr className={classNames.tableHeader}>\r\n                <td className={classNames.tableHexCell}>{props.hexLabel}</td>\r\n                <td>{props.redLabel}</td>\r\n                <td>{props.greenLabel}</td>\r\n                <td>{props.blueLabel}</td>\r\n                {!props.alphaSliderHidden && <td>{props.alphaLabel}</td>}\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              <tr>\r\n                {...colorComponents.map((comp: keyof IRGBHex) => {\r\n                  if (comp === 'a' && props.alphaSliderHidden) {\r\n                    return null;\r\n                  }\r\n                  return (\r\n                    <td key={comp} style={comp === 'hex' ? undefined : { width: '18%' }}>\r\n                      <TextField\r\n                        className={classNames.input}\r\n                        onChange={this._textChangeHandlers[comp]}\r\n                        value={this._getDisplayValue(comp)}\r\n                        spellCheck={false}\r\n                        ariaLabel={this._textLabels[comp]}\r\n                      />\r\n                    </td>\r\n                  );\r\n                })}\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private _getDisplayValue(component: keyof IColor): string {\r\n    const { color } = this.state;\r\n    if (typeof color[component] === 'number') {\r\n      return String(component === 'a' ? color.a!.toPrecision(3) : color[component]);\r\n    }\r\n    return (color[component] as string) || '';\r\n  }\r\n\r\n  private _onSVChanged = (ev: React.MouseEvent<HTMLElement>, color: IColor): void => {\r\n    this._updateColor(ev, color);\r\n  };\r\n\r\n  private _onHChanged = (ev: React.MouseEvent<HTMLElement>, h: number): void => {\r\n    this._updateColor(ev, updateH(this.state.color, h));\r\n  };\r\n\r\n  private _onAChanged = (ev: React.MouseEvent<HTMLElement>, a: number): void => {\r\n    this._updateColor(ev, updateA(this.state.color, a));\r\n  };\r\n\r\n  private _onTextChange(component: keyof IRGBHex, event: React.FormEvent<HTMLInputElement>, newValue?: string): void {\r\n    const color = this.state.color;\r\n    const isHex = component === 'hex';\r\n    if (String(color[component]) === newValue) {\r\n      return;\r\n    }\r\n\r\n    let newColor: IColor | undefined;\r\n    if (isHex) {\r\n      newColor = getColorFromString('#' + newValue);\r\n    } else {\r\n      newColor = getColorFromRGBA({\r\n        r: color.r,\r\n        g: color.g,\r\n        b: color.b,\r\n        a: color.a || 100,\r\n        [component]: Number(newValue)\r\n      });\r\n    }\r\n    this._updateColor(event, newColor);\r\n  }\r\n\r\n  /**\r\n   * Update the displayed color and call change handlers if appropriate.\r\n   * @param ev - Event if call was triggered by an event (undefined if triggered by props change)\r\n   * @param newColor - Updated color\r\n   */\r\n  private _updateColor(ev: React.SyntheticEvent<HTMLElement> | undefined, newColor: IColor | undefined): void {\r\n    if (!newColor) {\r\n      return;\r\n    }\r\n\r\n    const props = this.props;\r\n    const { color } = this.state;\r\n    const isDifferentColor = newColor.h !== color.h || newColor.str !== color.str;\r\n\r\n    if (isDifferentColor) {\r\n      this.setState({ color: newColor }, () => {\r\n        if (ev && props.onChange) {\r\n          props.onChange(ev, newColor);\r\n        }\r\n\r\n        // To preserve the existing behavior, this one is called even when the change comes from a\r\n        // props update (which is not very useful)\r\n        if (props.onColorChanged) {\r\n          props.onColorChanged(newColor.str, newColor);\r\n        }\r\n      });\r\n    }\r\n  }\r\n}\r\n\r\nfunction _getColorFromProps(props: IColorPickerProps): IColor | undefined {\r\n  const { color } = props;\r\n  return typeof color === 'string' ? getColorFromString(color) : color;\r\n}\r\n"]}