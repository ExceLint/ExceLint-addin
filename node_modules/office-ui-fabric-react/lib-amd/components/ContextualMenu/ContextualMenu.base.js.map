{"version":3,"file":"ContextualMenu.base.js","sourceRoot":"../src/","sources":["components/ContextualMenu/ContextualMenu.base.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {\r\n  IContextualMenuProps,\r\n  IContextualMenuItem,\r\n  ContextualMenuItemType,\r\n  IContextualMenuListProps,\r\n  IContextualMenuStyleProps,\r\n  IContextualMenuStyles\r\n} from './ContextualMenu.types';\r\nimport { DirectionalHint } from '../../common/DirectionalHint';\r\nimport { FocusZone, FocusZoneDirection, IFocusZoneProps, FocusZoneTabbableElements } from '../../FocusZone';\r\nimport { IMenuItemClassNames, IContextualMenuClassNames } from './ContextualMenu.classNames';\r\nimport { divProperties, getNativeProps } from '../../Utilities';\r\n\r\nimport {\r\n  assign,\r\n  BaseComponent,\r\n  classNamesFunction,\r\n  css,\r\n  getDocument,\r\n  getFirstFocusable,\r\n  getId,\r\n  getLastFocusable,\r\n  getRTL,\r\n  getWindow,\r\n  IRenderFunction,\r\n  IPoint,\r\n  KeyCodes,\r\n  shouldWrapFocus,\r\n  IStyleFunctionOrObject,\r\n  isIOS,\r\n  isMac\r\n} from '../../Utilities';\r\nimport { hasSubmenu, getIsChecked, isItemDisabled } from '../../utilities/contextualMenu/index';\r\nimport { withResponsiveMode, ResponsiveMode } from '../../utilities/decorators/withResponsiveMode';\r\nimport { Callout, ICalloutContentStyleProps, ICalloutContentStyles } from '../../Callout';\r\nimport { ContextualMenu } from './ContextualMenu';\r\nimport { ContextualMenuItem } from './ContextualMenuItem';\r\nimport { ContextualMenuSplitButton, ContextualMenuButton, ContextualMenuAnchor } from './ContextualMenuItemWrapper/index';\r\nimport { IProcessedStyleSet, mergeStyleSets } from '../../Styling';\r\nimport { IContextualMenuItemStyleProps, IContextualMenuItemStyles } from './ContextualMenuItem.types';\r\n\r\nimport { getItemStyles } from './ContextualMenu.classNames';\r\n\r\nconst getClassNames = classNamesFunction<IContextualMenuStyleProps, IContextualMenuStyles>();\r\nconst getContextualMenuItemClassNames = classNamesFunction<IContextualMenuItemStyleProps, IContextualMenuItemStyles>();\r\n\r\nexport interface IContextualMenuState {\r\n  expandedMenuItemKey?: string;\r\n  /** True if the menu was expanded by mouse click OR hover (as opposed to by keyboard) */\r\n  expandedByMouseClick?: boolean;\r\n  dismissedMenuItemKey?: string;\r\n  contextualMenuItems?: IContextualMenuItem[];\r\n  contextualMenuTarget?: Element;\r\n  submenuTarget?: Element;\r\n  positions?: any;\r\n  slideDirectionalClassName?: string;\r\n  subMenuId?: string;\r\n  submenuDirection?: DirectionalHint;\r\n}\r\n\r\nexport function getSubmenuItems(item: IContextualMenuItem): IContextualMenuItem[] | undefined {\r\n  return item.subMenuProps ? item.subMenuProps.items : item.items;\r\n}\r\n\r\n/**\r\n * Returns true if a list of menu items can contain a checkbox\r\n */\r\nexport function canAnyMenuItemsCheck(items: IContextualMenuItem[]): boolean {\r\n  return items.some(item => {\r\n    if (item.canCheck) {\r\n      return true;\r\n    }\r\n\r\n    // If the item is a section, check if any of the items in the section can check.\r\n    if (item.sectionProps && item.sectionProps.items.some(submenuItem => submenuItem.canCheck === true)) {\r\n      return true;\r\n    }\r\n\r\n    return false;\r\n  });\r\n}\r\n\r\nconst NavigationIdleDelay = 250 /* ms */;\r\n\r\n@withResponsiveMode\r\nexport class ContextualMenuBase extends BaseComponent<IContextualMenuProps, IContextualMenuState> {\r\n  // The default ContextualMenu properties have no items and beak, the default submenu direction is right and top.\r\n  public static defaultProps: IContextualMenuProps = {\r\n    items: [],\r\n    shouldFocusOnMount: true,\r\n    gapSpace: 0,\r\n    directionalHint: DirectionalHint.bottomAutoEdge,\r\n    beakWidth: 16\r\n  };\r\n\r\n  private _host: HTMLElement;\r\n  private _previousActiveElement: HTMLElement | null;\r\n  private _isFocusingPreviousElement: boolean;\r\n  private _enterTimerId: number | undefined;\r\n  private _targetWindow: Window;\r\n  private _target: Element | MouseEvent | IPoint | null;\r\n  private _isScrollIdle: boolean;\r\n  private _scrollIdleTimeoutId: number | undefined;\r\n  /** True if the most recent keydown event was for alt (option) or meta (command). */\r\n  private _lastKeyDownWasAltOrMeta: boolean | undefined;\r\n  private _shouldUpdateFocusOnMouseEvent: boolean;\r\n  private _gotMouseMove: boolean;\r\n  private _mounted = false;\r\n\r\n  private _adjustedFocusZoneProps: IFocusZoneProps;\r\n\r\n  private _classNames: IProcessedStyleSet<IContextualMenuStyles> | IContextualMenuClassNames;\r\n\r\n  constructor(props: IContextualMenuProps) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      contextualMenuItems: undefined,\r\n      subMenuId: getId('ContextualMenu')\r\n    };\r\n\r\n    this._warnDeprecations({\r\n      getMenuClassNames: 'styles'\r\n    });\r\n\r\n    this._isFocusingPreviousElement = false;\r\n    this._isScrollIdle = true;\r\n    this._shouldUpdateFocusOnMouseEvent = !this.props.delayUpdateFocusOnHover;\r\n    this._gotMouseMove = false;\r\n  }\r\n\r\n  public dismiss = (ev?: any, dismissAll?: boolean) => {\r\n    const { onDismiss } = this.props;\r\n\r\n    if (onDismiss) {\r\n      onDismiss(ev, dismissAll);\r\n    }\r\n  };\r\n\r\n  public componentWillUpdate(newProps: IContextualMenuProps): void {\r\n    if (newProps.target !== this.props.target) {\r\n      const newTarget = newProps.target;\r\n      this._setTargetWindowAndElement(newTarget!);\r\n    }\r\n    if (newProps.hidden !== this.props.hidden) {\r\n      if (newProps.hidden) {\r\n        this._onMenuClosed();\r\n      } else {\r\n        this._onMenuOpened();\r\n        this._previousActiveElement = this._targetWindow ? (this._targetWindow.document.activeElement as HTMLElement) : null;\r\n      }\r\n    }\r\n    if (newProps.delayUpdateFocusOnHover !== this.props.delayUpdateFocusOnHover) {\r\n      // update shouldUpdateFocusOnMouseEvent to follow what was passed in\r\n      this._shouldUpdateFocusOnMouseEvent = !newProps.delayUpdateFocusOnHover;\r\n\r\n      // If shouldUpdateFocusOnMouseEvent is false, we need to reset gotMouseMove to false\r\n      this._gotMouseMove = this._shouldUpdateFocusOnMouseEvent && this._gotMouseMove;\r\n    }\r\n  }\r\n\r\n  // Invoked once, both on the client and server, immediately before the initial rendering occurs.\r\n  public componentWillMount() {\r\n    const target = this.props.target;\r\n    this._setTargetWindowAndElement(target!);\r\n    if (!this.props.hidden) {\r\n      this._previousActiveElement = this._targetWindow ? (this._targetWindow.document.activeElement as HTMLElement) : null;\r\n    }\r\n  }\r\n\r\n  // Invoked once, only on the client (not on the server), immediately after the initial rendering occurs.\r\n  public componentDidMount(): void {\r\n    if (!this.props.hidden) {\r\n      this._onMenuOpened();\r\n    }\r\n\r\n    this._mounted = true;\r\n  }\r\n\r\n  // Invoked immediately before a component is unmounted from the DOM.\r\n  public componentWillUnmount() {\r\n    if (this._isFocusingPreviousElement && this._previousActiveElement) {\r\n      // This slight delay is required so that we can unwind the stack, const react try to mess with focus, and then\r\n      // apply the correct focus. Without the setTimeout, we end up focusing the correct thing, and then React wants\r\n      // to reset the focus back to the thing it thinks should have been focused.\r\n      // Note: Cannot be replaced by this._async.setTimout because those will be removed by the time this is called.\r\n      setTimeout(() => {\r\n        this._previousActiveElement && this._previousActiveElement!.focus();\r\n      }, 0);\r\n    }\r\n\r\n    if (this.props.onMenuDismissed) {\r\n      this.props.onMenuDismissed(this.props);\r\n    }\r\n\r\n    this._events.dispose();\r\n    this._async.dispose();\r\n    this._mounted = false;\r\n  }\r\n\r\n  public render(): JSX.Element | null {\r\n    let { isBeakVisible } = this.props;\r\n\r\n    const {\r\n      items,\r\n      labelElementId,\r\n      id,\r\n      className,\r\n      beakWidth,\r\n      directionalHint,\r\n      directionalHintForRTL,\r\n      alignTargetEdge,\r\n      gapSpace,\r\n      coverTarget,\r\n      ariaLabel,\r\n      doNotLayer,\r\n      target,\r\n      bounds,\r\n      useTargetWidth,\r\n      useTargetAsMinWidth,\r\n      directionalHintFixed,\r\n      shouldFocusOnMount,\r\n      shouldFocusOnContainer,\r\n      title,\r\n      styles,\r\n      theme,\r\n      calloutProps,\r\n      onRenderSubMenu = this._onRenderSubMenu,\r\n      onRenderMenuList = this._onRenderMenuList,\r\n      focusZoneProps,\r\n      getMenuClassNames\r\n    } = this.props;\r\n\r\n    this._classNames = getMenuClassNames\r\n      ? getMenuClassNames(theme!, className)\r\n      : getClassNames(styles, {\r\n          theme: theme!,\r\n          className: className\r\n        });\r\n\r\n    const hasIcons = itemsHaveIcons(items);\r\n\r\n    function itemsHaveIcons(contextualMenuItems: IContextualMenuItem[]): boolean {\r\n      for (const item of contextualMenuItems) {\r\n        if (!!item.iconProps) {\r\n          return true;\r\n        }\r\n\r\n        if (item.itemType === ContextualMenuItemType.Section && item.sectionProps && itemsHaveIcons(item.sectionProps.items)) {\r\n          return true;\r\n        }\r\n      }\r\n\r\n      return false;\r\n    }\r\n\r\n    this._adjustedFocusZoneProps = { ...focusZoneProps, direction: this._getFocusZoneDirection() };\r\n\r\n    const hasCheckmarks = canAnyMenuItemsCheck(items);\r\n    const submenuProps = this.state.expandedMenuItemKey ? this._getSubmenuProps() : null;\r\n\r\n    isBeakVisible = isBeakVisible === undefined ? this.props.responsiveMode! <= ResponsiveMode.medium : isBeakVisible;\r\n    /**\r\n     * When useTargetWidth is true, get the width of the target element and apply it for the context menu container\r\n     */\r\n    let contextMenuStyle;\r\n    const targetAsHtmlElement = this._target as HTMLElement;\r\n    if ((useTargetWidth || useTargetAsMinWidth) && targetAsHtmlElement && targetAsHtmlElement.offsetWidth) {\r\n      const targetBoundingRect = targetAsHtmlElement.getBoundingClientRect();\r\n      const targetWidth = targetBoundingRect.width - 2 /* Accounts for 1px border */;\r\n\r\n      if (useTargetWidth) {\r\n        contextMenuStyle = {\r\n          width: targetWidth\r\n        };\r\n      } else if (useTargetAsMinWidth) {\r\n        contextMenuStyle = {\r\n          minWidth: targetWidth\r\n        };\r\n      }\r\n    }\r\n\r\n    // The menu should only return if items were provided, if no items were provided then it should not appear.\r\n    if (items && items.length > 0) {\r\n      let totalItemCount = 0;\r\n      for (const item of items) {\r\n        if (item.itemType !== ContextualMenuItemType.Divider && item.itemType !== ContextualMenuItemType.Header) {\r\n          const itemCount = item.customOnRenderListLength ? item.customOnRenderListLength : 1;\r\n          totalItemCount += itemCount;\r\n        }\r\n      }\r\n\r\n      const calloutStyles =\r\n        !getMenuClassNames && this._classNames.subComponentStyles\r\n          ? (this._classNames.subComponentStyles.callout as IStyleFunctionOrObject<ICalloutContentStyleProps, ICalloutContentStyles>)\r\n          : undefined;\r\n\r\n      return (\r\n        <Callout\r\n          styles={calloutStyles}\r\n          {...calloutProps}\r\n          target={target}\r\n          isBeakVisible={isBeakVisible}\r\n          beakWidth={beakWidth}\r\n          directionalHint={directionalHint}\r\n          directionalHintForRTL={directionalHintForRTL}\r\n          gapSpace={gapSpace}\r\n          coverTarget={coverTarget}\r\n          doNotLayer={doNotLayer}\r\n          className={css('ms-ContextualMenu-Callout', calloutProps && calloutProps.className)}\r\n          setInitialFocus={shouldFocusOnMount}\r\n          onDismiss={this.props.onDismiss}\r\n          onScroll={this._onScroll}\r\n          bounds={bounds}\r\n          directionalHintFixed={directionalHintFixed}\r\n          alignTargetEdge={alignTargetEdge}\r\n          hidden={this.props.hidden}\r\n        >\r\n          <div\r\n            role=\"menu\"\r\n            aria-label={ariaLabel}\r\n            aria-labelledby={labelElementId}\r\n            style={contextMenuStyle}\r\n            ref={(host: HTMLDivElement) => (this._host = host)}\r\n            id={id}\r\n            className={this._classNames.container}\r\n            tabIndex={shouldFocusOnContainer ? 0 : -1}\r\n            onKeyDown={this._onMenuKeyDown}\r\n            onKeyUp={this._onKeyUp}\r\n            onFocusCapture={this._onMenuFocusCapture}\r\n          >\r\n            {title && <div className={this._classNames.title}> {title} </div>}\r\n            {items && items.length ? (\r\n              <FocusZone\r\n                {...this._adjustedFocusZoneProps}\r\n                className={this._classNames.root}\r\n                isCircularNavigation={true}\r\n                handleTabKey={FocusZoneTabbableElements.all}\r\n              >\r\n                {onRenderMenuList(\r\n                  {\r\n                    items,\r\n                    totalItemCount,\r\n                    hasCheckmarks,\r\n                    hasIcons\r\n                  },\r\n                  this._onRenderMenuList\r\n                )}\r\n              </FocusZone>\r\n            ) : null}\r\n            {submenuProps && onRenderSubMenu(submenuProps, this._onRenderSubMenu)}\r\n          </div>\r\n        </Callout>\r\n      );\r\n    } else {\r\n      return null;\r\n    }\r\n  }\r\n\r\n  private _onMenuOpened() {\r\n    this._events.on(this._targetWindow, 'resize', this.dismiss);\r\n    this._shouldUpdateFocusOnMouseEvent = !this.props.delayUpdateFocusOnHover;\r\n    this._gotMouseMove = false;\r\n    this.props.onMenuOpened && this.props.onMenuOpened(this.props);\r\n  }\r\n\r\n  private _onMenuClosed() {\r\n    this._events.off(this._targetWindow, 'resize', this.dismiss);\r\n    this._previousActiveElement &&\r\n      this._async.setTimeout(() => {\r\n        this._previousActiveElement && this._previousActiveElement!.focus();\r\n      }, 0);\r\n    this._shouldUpdateFocusOnMouseEvent = !this.props.delayUpdateFocusOnHover;\r\n  }\r\n\r\n  /**\r\n   * Gets the focusZoneDirection by using the arrowDirection if specified,\r\n   * the direction specificed in the focusZoneProps, or defaults to FocusZoneDirection.vertical\r\n   */\r\n  private _getFocusZoneDirection() {\r\n    const { focusZoneProps } = this.props;\r\n    return focusZoneProps && focusZoneProps.direction !== undefined ? focusZoneProps.direction : FocusZoneDirection.vertical;\r\n  }\r\n\r\n  private _onRenderSubMenu(subMenuProps: IContextualMenuProps) {\r\n    return <ContextualMenu {...subMenuProps} />;\r\n  }\r\n\r\n  private _onRenderMenuList = (\r\n    menuListProps: IContextualMenuListProps,\r\n    defaultRender?: IRenderFunction<IContextualMenuListProps>\r\n  ): JSX.Element => {\r\n    let indexCorrection = 0;\r\n    return (\r\n      <ul className={this._classNames.list} onKeyDown={this._onKeyDown} onKeyUp={this._onKeyUp} role=\"menu\">\r\n        {menuListProps.items.map((item, index) => {\r\n          const menuItem = this._renderMenuItem(\r\n            item,\r\n            index,\r\n            indexCorrection,\r\n            menuListProps.totalItemCount,\r\n            menuListProps.hasCheckmarks,\r\n            menuListProps.hasIcons\r\n          );\r\n          if (item.itemType !== ContextualMenuItemType.Divider && item.itemType !== ContextualMenuItemType.Header) {\r\n            const indexIncrease = item.customOnRenderListLength ? item.customOnRenderListLength : 1;\r\n            indexCorrection += indexIncrease;\r\n          }\r\n          return menuItem;\r\n        })}\r\n      </ul>\r\n    );\r\n  };\r\n\r\n  private _renderMenuItem(\r\n    item: IContextualMenuItem,\r\n    index: number,\r\n    focusableElementIndex: number,\r\n    totalItemCount: number,\r\n    hasCheckmarks: boolean,\r\n    hasIcons: boolean\r\n  ): React.ReactNode {\r\n    const renderedItems: React.ReactNode[] = [];\r\n    const iconProps = item.iconProps || { iconName: 'None' };\r\n    const { getItemClassNames, itemProps } = item;\r\n    const styles = itemProps ? itemProps.styles : undefined;\r\n\r\n    // We only send a dividerClassName when the item to be rendered is a divider. For all other cases, the default divider style is used.\r\n    const dividerClassName = item.itemType === ContextualMenuItemType.Divider ? item.className : undefined;\r\n    const subMenuIconClassName = item.submenuIconProps ? item.submenuIconProps.className : '';\r\n\r\n    let itemClassNames: IMenuItemClassNames;\r\n\r\n    // IContextualMenuItem#getItemClassNames for backwards compatibility\r\n    // otherwise uses mergeStyles for class names.\r\n    if (getItemClassNames) {\r\n      itemClassNames = getItemClassNames(\r\n        this.props.theme!,\r\n        isItemDisabled(item),\r\n        this.state.expandedMenuItemKey === item.key,\r\n        !!getIsChecked(item),\r\n        !!item.href,\r\n        iconProps.iconName !== 'None',\r\n        item.className,\r\n        dividerClassName,\r\n        iconProps.className,\r\n        subMenuIconClassName,\r\n        item.primaryDisabled\r\n      );\r\n    } else {\r\n      const itemStyleProps: IContextualMenuItemStyleProps = {\r\n        theme: this.props.theme!,\r\n        disabled: isItemDisabled(item),\r\n        expanded: this.state.expandedMenuItemKey === item.key,\r\n        checked: !!getIsChecked(item),\r\n        isAnchorLink: !!item.href,\r\n        knownIcon: iconProps.iconName !== 'None',\r\n        itemClassName: item.className,\r\n        dividerClassName,\r\n        iconClassName: iconProps.className,\r\n        subMenuClassName: subMenuIconClassName,\r\n        primaryDisabled: item.primaryDisabled\r\n      };\r\n\r\n      const menuItemStyles = this._classNames.subComponentStyles\r\n        ? (this._classNames.subComponentStyles.menuItem as IStyleFunctionOrObject<IContextualMenuItemStyleProps, IContextualMenuItemStyles>)\r\n        : undefined;\r\n\r\n      // We need to generate default styles then override if styles are provided\r\n      // since the ContextualMenu currently handles item classNames.\r\n      itemClassNames = mergeStyleSets(\r\n        getContextualMenuItemClassNames(getItemStyles, itemStyleProps),\r\n        getContextualMenuItemClassNames(menuItemStyles, itemStyleProps),\r\n        getContextualMenuItemClassNames(styles, itemStyleProps)\r\n      );\r\n    }\r\n\r\n    if (item.text === '-' || item.name === '-') {\r\n      item.itemType = ContextualMenuItemType.Divider;\r\n    }\r\n    switch (item.itemType) {\r\n      case ContextualMenuItemType.Divider:\r\n        renderedItems.push(this._renderSeparator(index, itemClassNames));\r\n        break;\r\n      case ContextualMenuItemType.Header:\r\n        renderedItems.push(this._renderSeparator(index, itemClassNames));\r\n        const headerItem = this._renderHeaderMenuItem(item, itemClassNames, index, hasCheckmarks, hasIcons);\r\n        renderedItems.push(this._renderListItem(headerItem, item.key || index, itemClassNames, item.title));\r\n        break;\r\n      case ContextualMenuItemType.Section:\r\n        renderedItems.push(this._renderSectionItem(item, itemClassNames, index, hasCheckmarks, hasIcons));\r\n        break;\r\n      default:\r\n        const menuItem = this._renderNormalItem(\r\n          item,\r\n          itemClassNames,\r\n          index,\r\n          focusableElementIndex,\r\n          totalItemCount,\r\n          hasCheckmarks,\r\n          hasIcons\r\n        );\r\n        renderedItems.push(this._renderListItem(menuItem, item.key || index, itemClassNames, item.title));\r\n        break;\r\n    }\r\n\r\n    return renderedItems;\r\n  }\r\n\r\n  private _renderSectionItem(\r\n    sectionItem: IContextualMenuItem,\r\n    menuClassNames: IMenuItemClassNames,\r\n    index: number,\r\n    hasCheckmarks: boolean,\r\n    hasIcons: boolean\r\n  ) {\r\n    const sectionProps = sectionItem.sectionProps;\r\n    if (!sectionProps) {\r\n      return;\r\n    }\r\n\r\n    let headerItem;\r\n    if (sectionProps.title) {\r\n      const headerContextualMenuItem: IContextualMenuItem = {\r\n        key: `section-${sectionProps.title}-title`,\r\n        itemType: ContextualMenuItemType.Header,\r\n        text: sectionProps.title\r\n      };\r\n      headerItem = this._renderHeaderMenuItem(headerContextualMenuItem, menuClassNames, index, hasCheckmarks, hasIcons);\r\n    }\r\n\r\n    if (sectionProps.items && sectionProps.items.length > 0) {\r\n      return (\r\n        <li role=\"presentation\" key={sectionProps.key || sectionItem.key || `section-${index}`}>\r\n          <div role=\"group\">\r\n            <ul className={this._classNames.list}>\r\n              {sectionProps.topDivider && this._renderSeparator(index, menuClassNames, true, true)}\r\n              {headerItem && this._renderListItem(headerItem, sectionItem.key || index, menuClassNames, sectionItem.title)}\r\n              {sectionProps.items.map((contextualMenuItem, itemsIndex) =>\r\n                this._renderMenuItem(contextualMenuItem, itemsIndex, itemsIndex, sectionProps.items.length, hasCheckmarks, hasIcons)\r\n              )}\r\n              {sectionProps.bottomDivider && this._renderSeparator(index, menuClassNames, false, true)}\r\n            </ul>\r\n          </div>\r\n        </li>\r\n      );\r\n    }\r\n  }\r\n\r\n  private _renderListItem(content: React.ReactNode, key: string | number, classNames: IMenuItemClassNames, title?: string) {\r\n    return (\r\n      <li role=\"presentation\" title={title} key={key} className={classNames.item}>\r\n        {content}\r\n      </li>\r\n    );\r\n  }\r\n\r\n  private _renderSeparator(index: number, classNames: IMenuItemClassNames, top?: boolean, fromSection?: boolean): React.ReactNode {\r\n    if (fromSection || index > 0) {\r\n      return (\r\n        <li\r\n          role=\"separator\"\r\n          key={'separator-' + index + (top === undefined ? '' : top ? '-top' : '-bottom')}\r\n          className={classNames.divider}\r\n          aria-hidden=\"true\"\r\n        />\r\n      );\r\n    }\r\n    return null;\r\n  }\r\n\r\n  private _renderNormalItem(\r\n    item: IContextualMenuItem,\r\n    classNames: IMenuItemClassNames,\r\n    index: number,\r\n    focusableElementIndex: number,\r\n    totalItemCount: number,\r\n    hasCheckmarks: boolean,\r\n    hasIcons: boolean\r\n  ): React.ReactNode {\r\n    if (item.onRender) {\r\n      return item.onRender({ 'aria-posinset': focusableElementIndex + 1, 'aria-setsize': totalItemCount, ...item }, this.dismiss);\r\n    }\r\n    if (item.href) {\r\n      return this._renderAnchorMenuItem(item, classNames, index, focusableElementIndex, totalItemCount, hasCheckmarks, hasIcons);\r\n    }\r\n\r\n    if (item.split && hasSubmenu(item)) {\r\n      return this._renderSplitButton(item, classNames, index, focusableElementIndex, totalItemCount, hasCheckmarks, hasIcons);\r\n    }\r\n\r\n    return this._renderButtonItem(item, classNames, index, focusableElementIndex, totalItemCount, hasCheckmarks, hasIcons);\r\n  }\r\n\r\n  private _renderHeaderMenuItem(\r\n    item: IContextualMenuItem,\r\n    classNames: IMenuItemClassNames,\r\n    index: number,\r\n    hasCheckmarks: boolean,\r\n    hasIcons: boolean\r\n  ): React.ReactNode {\r\n    const { contextualMenuItemAs: ChildrenRenderer = ContextualMenuItem } = this.props;\r\n    const { itemProps } = item;\r\n    const divHtmlProperties = itemProps && getNativeProps(itemProps, divProperties);\r\n    return (\r\n      <div className={this._classNames.header} {...divHtmlProperties} style={item.style}>\r\n        <ChildrenRenderer\r\n          item={item}\r\n          classNames={classNames}\r\n          index={index}\r\n          onCheckmarkClick={hasCheckmarks ? this._onItemClick : undefined}\r\n          hasIcons={hasIcons}\r\n          {...itemProps}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  private _renderAnchorMenuItem(\r\n    item: IContextualMenuItem,\r\n    classNames: IMenuItemClassNames,\r\n    index: number,\r\n    focusableElementIndex: number,\r\n    totalItemCount: number,\r\n    hasCheckmarks: boolean,\r\n    hasIcons: boolean\r\n  ): React.ReactNode {\r\n    const { contextualMenuItemAs } = this.props;\r\n    const { expandedMenuItemKey } = this.state;\r\n    return (\r\n      <ContextualMenuAnchor\r\n        item={item}\r\n        classNames={classNames}\r\n        index={index}\r\n        focusableElementIndex={focusableElementIndex}\r\n        totalItemCount={totalItemCount}\r\n        hasCheckmarks={hasCheckmarks}\r\n        hasIcons={hasIcons}\r\n        contextualMenuItemAs={contextualMenuItemAs}\r\n        onItemMouseEnter={this._onItemMouseEnterBase}\r\n        onItemMouseLeave={this._onMouseItemLeave}\r\n        onItemMouseMove={this._onItemMouseMoveBase}\r\n        onItemMouseDown={this._onItemMouseDown}\r\n        executeItemClick={this._executeItemClick}\r\n        onItemClick={this._onAnchorClick}\r\n        onItemKeyDown={this._onItemKeyDown}\r\n        getSubMenuId={this._getSubMenuId}\r\n        expandedMenuItemKey={expandedMenuItemKey}\r\n        openSubMenu={this._onItemSubMenuExpand}\r\n        dismissSubMenu={this._onSubMenuDismiss}\r\n        dismissMenu={this.dismiss}\r\n      />\r\n    );\r\n  }\r\n\r\n  private _renderButtonItem(\r\n    item: IContextualMenuItem,\r\n    classNames: IMenuItemClassNames,\r\n    index: number,\r\n    focusableElementIndex: number,\r\n    totalItemCount: number,\r\n    hasCheckmarks?: boolean,\r\n    hasIcons?: boolean\r\n  ) {\r\n    const { contextualMenuItemAs } = this.props;\r\n    const { expandedMenuItemKey } = this.state;\r\n\r\n    return (\r\n      <ContextualMenuButton\r\n        item={item}\r\n        classNames={classNames}\r\n        index={index}\r\n        focusableElementIndex={focusableElementIndex}\r\n        totalItemCount={totalItemCount}\r\n        hasCheckmarks={hasCheckmarks}\r\n        hasIcons={hasIcons}\r\n        contextualMenuItemAs={contextualMenuItemAs}\r\n        onItemMouseEnter={this._onItemMouseEnterBase}\r\n        onItemMouseLeave={this._onMouseItemLeave}\r\n        onItemMouseMove={this._onItemMouseMoveBase}\r\n        onItemMouseDown={this._onItemMouseDown}\r\n        executeItemClick={this._executeItemClick}\r\n        onItemClick={this._onItemClick}\r\n        onItemClickBase={this._onItemClickBase}\r\n        onItemKeyDown={this._onItemKeyDown}\r\n        getSubMenuId={this._getSubMenuId}\r\n        expandedMenuItemKey={expandedMenuItemKey}\r\n        openSubMenu={this._onItemSubMenuExpand}\r\n        dismissSubMenu={this._onSubMenuDismiss}\r\n        dismissMenu={this.dismiss}\r\n      />\r\n    );\r\n  }\r\n\r\n  private _renderSplitButton(\r\n    item: IContextualMenuItem,\r\n    classNames: IMenuItemClassNames,\r\n    index: number,\r\n    focusableElementIndex: number,\r\n    totalItemCount: number,\r\n    hasCheckmarks?: boolean,\r\n    hasIcons?: boolean\r\n  ): JSX.Element {\r\n    const { contextualMenuItemAs } = this.props;\r\n    const { expandedMenuItemKey } = this.state;\r\n\r\n    return (\r\n      <ContextualMenuSplitButton\r\n        item={item}\r\n        classNames={classNames}\r\n        index={index}\r\n        focusableElementIndex={focusableElementIndex}\r\n        totalItemCount={totalItemCount}\r\n        hasCheckmarks={hasCheckmarks}\r\n        hasIcons={hasIcons}\r\n        contextualMenuItemAs={contextualMenuItemAs}\r\n        onItemMouseEnter={this._onItemMouseEnterBase}\r\n        onItemMouseLeave={this._onMouseItemLeave}\r\n        onItemMouseMove={this._onItemMouseMoveBase}\r\n        onItemMouseDown={this._onItemMouseDown}\r\n        executeItemClick={this._executeItemClick}\r\n        onItemClick={this._onItemClick}\r\n        onItemClickBase={this._onItemClickBase}\r\n        onItemKeyDown={this._onItemKeyDown}\r\n        openSubMenu={this._onItemSubMenuExpand}\r\n        dismissSubMenu={this._onSubMenuDismiss}\r\n        dismissMenu={this.dismiss}\r\n        expandedMenuItemKey={expandedMenuItemKey}\r\n        onTap={this._onPointerAndTouchEvent}\r\n      />\r\n    );\r\n  }\r\n\r\n  private _onKeyDown = (ev: React.KeyboardEvent<HTMLElement>): boolean => {\r\n    // Take note if we are processing an alt (option) or meta (command) keydown.\r\n    // See comment in _shouldHandleKeyUp for reasoning.\r\n    this._lastKeyDownWasAltOrMeta = this._isAltOrMeta(ev);\r\n\r\n    // On Mac, pressing escape dismisses all levels of native context menus\r\n    const dismissAllMenus = ev.which === KeyCodes.escape && (isMac() || isIOS());\r\n\r\n    return this._keyHandler(ev, this._shouldHandleKeyDown, dismissAllMenus);\r\n  };\r\n\r\n  private _shouldHandleKeyDown = (ev: React.KeyboardEvent<HTMLElement>) => {\r\n    return ev.which === KeyCodes.escape || this._shouldCloseSubMenu(ev) || (ev.which === KeyCodes.up && (ev.altKey || ev.metaKey));\r\n  };\r\n\r\n  private _onMenuFocusCapture = (ev: React.FocusEvent<HTMLElement>) => {\r\n    if (this.props.delayUpdateFocusOnHover) {\r\n      this._shouldUpdateFocusOnMouseEvent = true;\r\n    }\r\n  };\r\n\r\n  private _onKeyUp = (ev: React.KeyboardEvent<HTMLElement>): boolean => {\r\n    return this._keyHandler(ev, this._shouldHandleKeyUp, true /* dismissAllMenus */);\r\n  };\r\n\r\n  /**\r\n   * We close the menu on key up only if ALL of the following are true:\r\n   * - Most recent key down was alt or meta (command)\r\n   * - The alt/meta key down was NOT followed by some other key (such as down/up arrow to\r\n   *   expand/collapse the menu)\r\n   * - We're not on a Mac (or iOS)\r\n   *\r\n   * This is because on Windows, pressing alt moves focus to the application menu bar or similar,\r\n   * closing any open context menus. There is not a similar behavior on Macs.\r\n   */\r\n  private _shouldHandleKeyUp = (ev: React.KeyboardEvent<HTMLElement>) => {\r\n    const keyPressIsAltOrMetaAlone = this._lastKeyDownWasAltOrMeta && this._isAltOrMeta(ev);\r\n    this._lastKeyDownWasAltOrMeta = false;\r\n    return !!keyPressIsAltOrMetaAlone && !(isIOS() || isMac());\r\n  };\r\n\r\n  /**\r\n   * Returns true if the key for the event is alt (Mac option) or meta (Mac command).\r\n   */\r\n  private _isAltOrMeta(ev: React.KeyboardEvent<HTMLElement>): boolean {\r\n    return ev.which === KeyCodes.alt || ev.key === 'Meta';\r\n  }\r\n\r\n  /**\r\n   * Calls `shouldHandleKey` to determine whether the keyboard event should be handled;\r\n   * if so, stops event propagation and dismisses menu(s).\r\n   * @param ev The keyboard event.\r\n   * @param shouldHandleKey Returns whether we should handle this keyboard event.\r\n   * @param dismissAllMenus If true, dismiss all menus. Otherwise, dismiss only the current menu.\r\n   * Only does anything if `shouldHandleKey` returns true.\r\n   * @returns Whether the event was handled.\r\n   */\r\n  private _keyHandler = (\r\n    ev: React.KeyboardEvent<HTMLElement>,\r\n    shouldHandleKey: (ev: React.KeyboardEvent<HTMLElement>) => boolean,\r\n    dismissAllMenus?: boolean\r\n  ): boolean => {\r\n    let handled = false;\r\n\r\n    if (shouldHandleKey(ev)) {\r\n      this._isFocusingPreviousElement = true;\r\n      ev.preventDefault();\r\n      ev.stopPropagation();\r\n      this.dismiss(ev, dismissAllMenus);\r\n      handled = true;\r\n    }\r\n\r\n    return handled;\r\n  };\r\n\r\n  /**\r\n   * Checks if the submenu should be closed\r\n   */\r\n  private _shouldCloseSubMenu = (ev: React.KeyboardEvent<HTMLElement>): boolean => {\r\n    const submenuCloseKey = getRTL() ? KeyCodes.right : KeyCodes.left;\r\n\r\n    if (ev.which !== submenuCloseKey || !this.props.isSubMenu) {\r\n      return false;\r\n    }\r\n\r\n    return (\r\n      this._adjustedFocusZoneProps.direction === FocusZoneDirection.vertical ||\r\n      (!!this._adjustedFocusZoneProps.checkForNoWrap && !shouldWrapFocus(ev.target as HTMLElement, 'data-no-horizontal-wrap'))\r\n    );\r\n  };\r\n\r\n  private _onMenuKeyDown = (ev: React.KeyboardEvent<HTMLElement>) => {\r\n    // Mark as handled if onKeyDown returns true (for handling collapse cases)\r\n    // or if we are attempting to expand a submenu\r\n    const handled = this._onKeyDown(ev);\r\n\r\n    if (handled || !this._host) {\r\n      return;\r\n    }\r\n\r\n    // If we have a modifier key being pressed, we do not want to move focus.\r\n    // Otherwise, handle up and down keys.\r\n    const hasModifier = !!(ev.altKey || ev.metaKey);\r\n    const isUp = ev.which === KeyCodes.up;\r\n    const isDown = ev.which === KeyCodes.down;\r\n    if (!hasModifier && (isUp || isDown)) {\r\n      const elementToFocus = isUp\r\n        ? getLastFocusable(this._host, this._host.lastChild as HTMLElement, true)\r\n        : getFirstFocusable(this._host, this._host.firstChild as HTMLElement, true);\r\n\r\n      if (elementToFocus) {\r\n        elementToFocus.focus();\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n      }\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Scroll handler for the callout to make sure the mouse events\r\n   * for updating focus are not interacting during scroll\r\n   */\r\n  private _onScroll = (): void => {\r\n    if (!this._isScrollIdle && this._scrollIdleTimeoutId !== undefined) {\r\n      this._async.clearTimeout(this._scrollIdleTimeoutId);\r\n      this._scrollIdleTimeoutId = undefined;\r\n    } else {\r\n      this._isScrollIdle = false;\r\n    }\r\n\r\n    this._scrollIdleTimeoutId = this._async.setTimeout(() => {\r\n      this._isScrollIdle = true;\r\n    }, NavigationIdleDelay);\r\n  };\r\n\r\n  private _onItemMouseEnterBase = (item: any, ev: React.MouseEvent<HTMLElement>, target?: HTMLElement): void => {\r\n    if (this._shouldIgnoreMouseEvent()) {\r\n      return;\r\n    }\r\n\r\n    this._updateFocusOnMouseEvent(item, ev, target);\r\n  };\r\n\r\n  private _onItemMouseMoveBase = (item: any, ev: React.MouseEvent<HTMLElement>, target: HTMLElement): void => {\r\n    const targetElement = ev.currentTarget as HTMLElement;\r\n\r\n    // Always do this check to make sure we record a mouseMove if needed (even if we are timed out)\r\n    if (this._shouldUpdateFocusOnMouseEvent) {\r\n      this._gotMouseMove = true;\r\n    } else {\r\n      return;\r\n    }\r\n\r\n    if (\r\n      !this._isScrollIdle ||\r\n      this._enterTimerId !== undefined ||\r\n      targetElement === (this._targetWindow.document.activeElement as HTMLElement)\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    this._updateFocusOnMouseEvent(item, ev, target);\r\n  };\r\n\r\n  private _shouldIgnoreMouseEvent(): boolean {\r\n    return !this._isScrollIdle || !this._gotMouseMove;\r\n  }\r\n\r\n  private _onMouseItemLeave = (item: any, ev: React.MouseEvent<HTMLElement>): void => {\r\n    if (this._shouldIgnoreMouseEvent()) {\r\n      return;\r\n    }\r\n\r\n    if (this._enterTimerId !== undefined) {\r\n      this._async.clearTimeout(this._enterTimerId);\r\n      this._enterTimerId = undefined;\r\n    }\r\n\r\n    if (this.state.expandedMenuItemKey !== undefined) {\r\n      return;\r\n    }\r\n\r\n    /**\r\n     * IE11 focus() method forces parents to scroll to top of element.\r\n     * Edge and IE expose a setActive() function for focusable divs that\r\n     * sets the page focus but does not scroll the parent element.\r\n     */\r\n    if ((this._host as any).setActive) {\r\n      try {\r\n        (this._host as any).setActive();\r\n      } catch (e) {\r\n        /* no-op */\r\n      }\r\n    } else {\r\n      this._host.focus();\r\n    }\r\n  };\r\n\r\n  /**\r\n   * Handles updating focus when mouseEnter or mouseMove fire.\r\n   * As part of updating focus, This function will also update\r\n   * the expand/collapse state accordingly.\r\n   */\r\n  private _updateFocusOnMouseEvent(item: IContextualMenuItem, ev: React.MouseEvent<HTMLElement>, target?: HTMLElement) {\r\n    const targetElement = target ? target : (ev.currentTarget as HTMLElement);\r\n    const { subMenuHoverDelay: timeoutDuration = NavigationIdleDelay } = this.props;\r\n\r\n    if (item.key === this.state.expandedMenuItemKey) {\r\n      return;\r\n    }\r\n\r\n    if (this._enterTimerId !== undefined) {\r\n      this._async.clearTimeout(this._enterTimerId);\r\n      this._enterTimerId = undefined;\r\n    }\r\n\r\n    // If the menu is not expanded we can update focus without any delay\r\n    if (this.state.expandedMenuItemKey === undefined) {\r\n      targetElement.focus();\r\n    }\r\n\r\n    // Delay updating expanding/dismissing the submenu\r\n    // and only set focus if we have not already done so\r\n    if (hasSubmenu(item)) {\r\n      ev.stopPropagation();\r\n      this._enterTimerId = this._async.setTimeout(() => {\r\n        targetElement.focus();\r\n        this.setState({\r\n          expandedByMouseClick: true\r\n        });\r\n        this._onItemSubMenuExpand(item, targetElement);\r\n        this._enterTimerId = undefined;\r\n      }, timeoutDuration);\r\n    } else {\r\n      this._enterTimerId = this._async.setTimeout(() => {\r\n        this._onSubMenuDismiss(ev);\r\n        targetElement.focus();\r\n        this._enterTimerId = undefined;\r\n      }, timeoutDuration);\r\n    }\r\n  }\r\n\r\n  private _onItemMouseDown = (item: IContextualMenuItem, ev: React.MouseEvent<HTMLElement>): void => {\r\n    if (item.onMouseDown) {\r\n      item.onMouseDown(item, ev);\r\n    }\r\n  };\r\n\r\n  private _onItemClick = (item: IContextualMenuItem, ev: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>): void => {\r\n    this._onItemClickBase(item, ev, ev.currentTarget as HTMLElement);\r\n  };\r\n\r\n  private _onItemClickBase = (\r\n    item: IContextualMenuItem,\r\n    ev: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>,\r\n    target: HTMLElement\r\n  ): void => {\r\n    const items = getSubmenuItems(item);\r\n\r\n    // Cancel a async menu item hover timeout action from being taken and instead\r\n    // just trigger the click event instead.\r\n    this._cancelSubMenuTimer();\r\n\r\n    if (!hasSubmenu(item) && (!items || !items.length)) {\r\n      // This is an item without a menu. Click it.\r\n      this._executeItemClick(item, ev);\r\n    } else {\r\n      if (item.key !== this.state.expandedMenuItemKey) {\r\n        // This has a collapsed sub menu. Expand it.\r\n        this.setState({\r\n          // When Edge + Narrator are used together (regardless of if the button is in a form or not), pressing\r\n          // \"Enter\" fires this method and not _onMenuKeyDown. Checking ev.nativeEvent.detail differentiates\r\n          // between a real click event and a keypress event (detail should be the number of mouse clicks).\r\n          // ...Plot twist! For a real click event in IE 11, detail is always 0 (Edge sets it properly to 1).\r\n          // So we also check the pointerType property, which both Edge and IE set to \"mouse\" for real clicks\r\n          // and \"\" for pressing \"Enter\" with Narrator on.\r\n          expandedByMouseClick: ev.nativeEvent.detail !== 0 || (ev.nativeEvent as PointerEvent).pointerType === 'mouse'\r\n        });\r\n        this._onItemSubMenuExpand(item, target);\r\n      }\r\n    }\r\n\r\n    ev.stopPropagation();\r\n    ev.preventDefault();\r\n  };\r\n\r\n  private _onAnchorClick = (item: IContextualMenuItem, ev: React.MouseEvent<HTMLElement>) => {\r\n    this._executeItemClick(item, ev);\r\n    ev.stopPropagation();\r\n  };\r\n\r\n  private _executeItemClick = (item: IContextualMenuItem, ev: React.MouseEvent<HTMLElement> | React.KeyboardEvent<HTMLElement>): void => {\r\n    if (item.disabled || item.isDisabled) {\r\n      return;\r\n    }\r\n\r\n    let dismiss = false;\r\n    if (item.onClick) {\r\n      dismiss = !!item.onClick(ev, item);\r\n    } else if (this.props.onItemClick) {\r\n      dismiss = !!this.props.onItemClick(ev, item);\r\n    }\r\n\r\n    (dismiss || !ev.defaultPrevented) && this.dismiss(ev, true);\r\n  };\r\n\r\n  private _onItemKeyDown = (item: any, ev: React.KeyboardEvent<HTMLElement>): void => {\r\n    const openKey = getRTL() ? KeyCodes.left : KeyCodes.right;\r\n\r\n    if (\r\n      !item.disabled &&\r\n      (ev.which === openKey || ev.which === KeyCodes.enter || (ev.which === KeyCodes.down && (ev.altKey || ev.metaKey)))\r\n    ) {\r\n      this.setState({\r\n        expandedByMouseClick: false\r\n      });\r\n      this._onItemSubMenuExpand(item, ev.currentTarget as HTMLElement);\r\n      ev.preventDefault();\r\n    }\r\n  };\r\n\r\n  // Cancel a async menu item hover timeout action from being taken and instead\r\n  // do new upcoming behavior\r\n  private _cancelSubMenuTimer = () => {\r\n    if (this._enterTimerId !== undefined) {\r\n      this._async.clearTimeout(this._enterTimerId);\r\n      this._enterTimerId = undefined;\r\n    }\r\n  };\r\n\r\n  private _onItemSubMenuExpand = (item: IContextualMenuItem, target: HTMLElement): void => {\r\n    if (this.state.expandedMenuItemKey !== item.key) {\r\n      if (this.state.expandedMenuItemKey) {\r\n        this._onSubMenuDismiss();\r\n      }\r\n\r\n      // Focus the target to ensure when we close it, we're focusing on the correct element.\r\n      target.focus();\r\n      this.setState({\r\n        expandedMenuItemKey: item.key,\r\n        submenuTarget: target\r\n      });\r\n    }\r\n  };\r\n\r\n  private _getSubmenuProps() {\r\n    const { submenuTarget, expandedMenuItemKey } = this.state;\r\n    const item = this._findItemByKey(expandedMenuItemKey!);\r\n    let submenuProps: IContextualMenuProps | null = null;\r\n\r\n    if (item) {\r\n      submenuProps = {\r\n        items: getSubmenuItems(item)!,\r\n        target: submenuTarget,\r\n        onDismiss: this._onSubMenuDismiss,\r\n        isSubMenu: true,\r\n        id: this.state.subMenuId,\r\n        shouldFocusOnMount: true,\r\n        shouldFocusOnContainer: this.state.expandedByMouseClick,\r\n        directionalHint: getRTL() ? DirectionalHint.leftTopEdge : DirectionalHint.rightTopEdge,\r\n        className: this.props.className,\r\n        gapSpace: 0,\r\n        isBeakVisible: false\r\n      };\r\n\r\n      if (item.subMenuProps) {\r\n        assign(submenuProps, item.subMenuProps);\r\n      }\r\n    }\r\n    return submenuProps;\r\n  }\r\n\r\n  private _findItemByKey(key: string): IContextualMenuItem | undefined {\r\n    const { items } = this.props;\r\n    return this._findItemByKeyFromItems(key, items);\r\n  }\r\n\r\n  /**\r\n   * Returns the item that mathes a given key if any.\r\n   * @param key The key of the item to match\r\n   * @param items The items to look for the key\r\n   */\r\n  private _findItemByKeyFromItems(key: string, items: IContextualMenuItem[]): IContextualMenuItem | undefined {\r\n    for (const item of items) {\r\n      if (item.itemType === ContextualMenuItemType.Section && item.sectionProps) {\r\n        const match = this._findItemByKeyFromItems(key, item.sectionProps.items);\r\n        if (match) {\r\n          return match;\r\n        }\r\n      } else if (item.key && item.key === key) {\r\n        return item;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * This function is called ASYNCHRONOUSLY, and so there is a chance it is called\r\n   * after the component is unmounted. The _mounted property is added to prevent\r\n   * from calling setState() after unmount. Do NOT copy this pattern in synchronous\r\n   * code.\r\n   */\r\n  private _onSubMenuDismiss = (ev?: any, dismissAll?: boolean): void => {\r\n    if (dismissAll) {\r\n      this.dismiss(ev, dismissAll);\r\n    } else if (this._mounted) {\r\n      this.setState({\r\n        dismissedMenuItemKey: this.state.expandedMenuItemKey,\r\n        expandedMenuItemKey: undefined,\r\n        submenuTarget: undefined\r\n      });\r\n    }\r\n  };\r\n\r\n  private _setTargetWindowAndElement(target: Element | string | MouseEvent | IPoint): void {\r\n    if (target) {\r\n      if (typeof target === 'string') {\r\n        const currentDoc: Document = getDocument()!;\r\n        this._target = currentDoc ? (currentDoc.querySelector(target) as Element) : null;\r\n        this._targetWindow = getWindow()!;\r\n      } else if ((target as MouseEvent).stopPropagation) {\r\n        this._targetWindow = getWindow((target as MouseEvent).toElement as HTMLElement)!;\r\n        this._target = target;\r\n      } else if ((target as IPoint).x !== undefined && (target as IPoint).y !== undefined) {\r\n        this._targetWindow = getWindow()!;\r\n        this._target = target;\r\n      } else {\r\n        const targetElement: Element = target as Element;\r\n        this._targetWindow = getWindow(targetElement)!;\r\n        this._target = target;\r\n      }\r\n    } else {\r\n      this._targetWindow = getWindow()!;\r\n    }\r\n  }\r\n\r\n  private _getSubMenuId = (item: IContextualMenuItem): string | undefined => {\r\n    let { subMenuId } = this.state;\r\n\r\n    if (item.subMenuProps && item.subMenuProps.id) {\r\n      subMenuId = item.subMenuProps.id;\r\n    }\r\n\r\n    return subMenuId;\r\n  };\r\n\r\n  private _onPointerAndTouchEvent = (ev: React.TouchEvent<HTMLElement> | PointerEvent) => {\r\n    this._cancelSubMenuTimer();\r\n  };\r\n}\r\n"]}