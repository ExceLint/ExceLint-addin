{"version":3,"file":"BaseExtendedPicker.js","sourceRoot":"../src/","sources":["components/ExtendedPicker/BaseExtendedPicker.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport { BaseComponent, KeyCodes, css } from '../../Utilities';\r\nimport { Autofill } from '../../Autofill';\r\nimport { IInputProps } from '../../Pickers';\r\nimport * as stylesImport from './BaseExtendedPicker.scss';\r\nimport { IBaseExtendedPickerProps, IBaseExtendedPicker } from './BaseExtendedPicker.types';\r\nimport { IBaseFloatingPickerProps, BaseFloatingPicker } from '../../FloatingPicker';\r\nimport { BaseSelectedItemsList, IBaseSelectedItemsListProps } from '../../SelectedItemsList';\r\nimport { FocusZone, FocusZoneDirection } from '../../FocusZone';\r\nimport { Selection, SelectionMode, SelectionZone } from '../../Selection';\r\n// tslint:disable-next-line:no-any\r\nconst styles: any = stylesImport;\r\n\r\nexport interface IBaseExtendedPickerState<T> {\r\n  queryString: string | null;\r\n  selectedItems: T[] | null;\r\n  suggestionItems: T[] | null;\r\n}\r\n\r\nexport class BaseExtendedPicker<T, P extends IBaseExtendedPickerProps<T>> extends BaseComponent<P, IBaseExtendedPickerState<T>>\r\n  implements IBaseExtendedPicker<T> {\r\n  public floatingPicker = React.createRef<BaseFloatingPicker<T, IBaseFloatingPickerProps<T>>>();\r\n  public selectedItemsList = React.createRef<BaseSelectedItemsList<T, IBaseSelectedItemsListProps<T>>>();\r\n\r\n  protected root = React.createRef<HTMLDivElement>();\r\n  protected input = React.createRef<Autofill>();\r\n  protected selection: Selection;\r\n  protected floatingPickerProps: IBaseFloatingPickerProps<T>;\r\n  protected selectedItemsListProps: IBaseSelectedItemsListProps<T>;\r\n\r\n  constructor(basePickerProps: P) {\r\n    super(basePickerProps);\r\n\r\n    this.selection = new Selection({ onSelectionChanged: () => this.onSelectionChange() });\r\n\r\n    this.state = {\r\n      queryString: '',\r\n      suggestionItems: this.props.suggestionItems ? (this.props.suggestionItems as T[]) : null,\r\n      selectedItems: this.props.defaultSelectedItems\r\n        ? (this.props.defaultSelectedItems as T[])\r\n        : this.props.selectedItems\r\n        ? (this.props.selectedItems as T[])\r\n        : null\r\n    };\r\n\r\n    this.floatingPickerProps = this.props.floatingPickerProps;\r\n    this.selectedItemsListProps = this.props.selectedItemsListProps;\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public get items(): any {\r\n    return this.state.selectedItems\r\n      ? this.state.selectedItems\r\n      : this.selectedItemsList.current\r\n      ? this.selectedItemsList.current.items\r\n      : null;\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this.forceUpdate();\r\n  }\r\n\r\n  public componentWillReceiveProps(newProps: P): void {\r\n    if (newProps.floatingPickerProps) {\r\n      this.floatingPickerProps = newProps.floatingPickerProps;\r\n    }\r\n\r\n    if (newProps.selectedItemsListProps) {\r\n      this.selectedItemsListProps = newProps.selectedItemsListProps;\r\n    }\r\n\r\n    if (newProps.selectedItems) {\r\n      this.setState({ selectedItems: newProps.selectedItems });\r\n    }\r\n  }\r\n\r\n  public focus(): void {\r\n    if (this.input.current) {\r\n      this.input.current.focus();\r\n    }\r\n  }\r\n\r\n  public clearInput(): void {\r\n    if (this.input.current) {\r\n      this.input.current.clear();\r\n    }\r\n  }\r\n\r\n  public get inputElement(): HTMLInputElement | null {\r\n    return this.input.current && this.input.current.inputElement;\r\n  }\r\n\r\n  public get highlightedItems(): T[] {\r\n    return this.selectedItemsList.current ? this.selectedItemsList.current.highlightedItems() : [];\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const { className, inputProps, disabled, focusZoneProps } = this.props;\r\n    const activeDescendant =\r\n      this.floatingPicker.current && this.floatingPicker.current.currentSelectedSuggestionIndex !== -1\r\n        ? 'sug-' + this.floatingPicker.current.currentSelectedSuggestionIndex\r\n        : undefined;\r\n\r\n    return (\r\n      <div\r\n        ref={this.root}\r\n        className={css('ms-BasePicker ms-BaseExtendedPicker', className ? className : '')}\r\n        onKeyDown={this.onBackspace}\r\n        onCopy={this.onCopy}\r\n      >\r\n        <FocusZone direction={FocusZoneDirection.bidirectional} {...focusZoneProps}>\r\n          <SelectionZone selection={this.selection} selectionMode={SelectionMode.multiple}>\r\n            <div className={css('ms-BasePicker-text', styles.pickerText)} role={'list'}>\r\n              {this.props.headerComponent}\r\n              {this.renderSelectedItemsList()}\r\n              {this.canAddItems() && (\r\n                <Autofill\r\n                  {...inputProps as IInputProps}\r\n                  className={css('ms-BasePicker-input', styles.pickerInput)}\r\n                  ref={this.input}\r\n                  onFocus={this.onInputFocus}\r\n                  onClick={this.onInputClick}\r\n                  onInputValueChange={this.onInputChange}\r\n                  aria-activedescendant={activeDescendant}\r\n                  aria-owns=\"suggestion-list\"\r\n                  aria-expanded={this.floatingPicker.current ? this.floatingPicker.current.isSuggestionsShown : false}\r\n                  aria-haspopup=\"true\"\r\n                  autoCapitalize=\"off\"\r\n                  autoComplete=\"off\"\r\n                  role=\"combobox\"\r\n                  disabled={disabled}\r\n                  onPaste={this.onPaste}\r\n                />\r\n              )}\r\n            </div>\r\n          </SelectionZone>\r\n        </FocusZone>\r\n        {this.renderFloatingPicker()}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  protected onSelectionChange = (): void => {\r\n    this.forceUpdate();\r\n  };\r\n\r\n  protected canAddItems(): boolean {\r\n    const { itemLimit } = this.props;\r\n    return itemLimit === undefined || this.items.length < itemLimit;\r\n  }\r\n\r\n  protected renderFloatingPicker(): JSX.Element {\r\n    const FloatingPicker: React.ComponentType<IBaseFloatingPickerProps<T>> = this.props.onRenderFloatingPicker;\r\n    return (\r\n      <FloatingPicker\r\n        componentRef={this.floatingPicker}\r\n        onChange={this._onSuggestionSelected}\r\n        inputElement={this.input.current ? this.input.current.inputElement : undefined}\r\n        selectedItems={this.items}\r\n        suggestionItems={this.props.suggestionItems ? this.props.suggestionItems : undefined}\r\n        {...this.floatingPickerProps}\r\n      />\r\n    );\r\n  }\r\n\r\n  protected renderSelectedItemsList(): JSX.Element {\r\n    const SelectedItems: React.ComponentType<IBaseSelectedItemsListProps<T>> = this.props.onRenderSelectedItems;\r\n    return (\r\n      <SelectedItems\r\n        componentRef={this.selectedItemsList}\r\n        selection={this.selection}\r\n        selectedItems={this.props.selectedItems ? this.props.selectedItems : undefined}\r\n        onItemsDeleted={this.props.selectedItems ? this.props.onItemsRemoved : undefined}\r\n        {...this.selectedItemsListProps}\r\n      />\r\n    );\r\n  }\r\n\r\n  protected onInputChange = (value: string): void => {\r\n    this.setState({ queryString: value });\r\n    if (this.floatingPicker.current) {\r\n      this.floatingPicker.current.onQueryStringChanged(value);\r\n    }\r\n  };\r\n\r\n  protected onInputFocus = (ev: React.FocusEvent<HTMLInputElement | Autofill>): void => {\r\n    if (this.selectedItemsList.current) {\r\n      this.selectedItemsList.current.unselectAll();\r\n    }\r\n\r\n    if (this.props.inputProps && this.props.inputProps.onFocus) {\r\n      this.props.inputProps.onFocus(ev as React.FocusEvent<HTMLInputElement>);\r\n    }\r\n  };\r\n\r\n  protected onInputClick = (ev: React.MouseEvent<HTMLInputElement | Autofill>): void => {\r\n    if (this.selectedItemsList.current) {\r\n      this.selectedItemsList.current.unselectAll();\r\n    }\r\n\r\n    if (this.floatingPicker.current && this.inputElement) {\r\n      // Update the value if the input value is empty or it is different than the current inputText from the floatingPicker\r\n      const shoudUpdateValue = this.inputElement.value === '' || this.inputElement.value !== this.floatingPicker.current.inputText;\r\n      this.floatingPicker.current.showPicker(shoudUpdateValue);\r\n    }\r\n  };\r\n\r\n  // This is protected because we may expect the backspace key to work differently in a different kind of picker.\r\n  // This lets the subclass override it and provide it's own onBackspace. For an example see the BasePickerListBelow\r\n  protected onBackspace = (ev: React.KeyboardEvent<HTMLElement>): void => {\r\n    if (ev.which !== KeyCodes.backspace) {\r\n      return;\r\n    }\r\n\r\n    if (this.selectedItemsList.current && this.items.length) {\r\n      if (\r\n        this.input.current &&\r\n        !this.input.current.isValueSelected &&\r\n        this.input.current.inputElement === document.activeElement &&\r\n        (this.input.current as Autofill).cursorLocation === 0\r\n      ) {\r\n        if (this.floatingPicker.current) {\r\n          this.floatingPicker.current.hidePicker();\r\n        }\r\n        ev.preventDefault();\r\n        this.selectedItemsList.current.removeItemAt(this.items.length - 1);\r\n        this._onSelectedItemsChanged();\r\n      } else if (this.selectedItemsList.current.hasSelectedItems()) {\r\n        if (this.floatingPicker.current) {\r\n          this.floatingPicker.current.hidePicker();\r\n        }\r\n        ev.preventDefault();\r\n        this.selectedItemsList.current.removeSelectedItems();\r\n        this._onSelectedItemsChanged();\r\n      }\r\n    }\r\n  };\r\n\r\n  protected onCopy = (ev: React.ClipboardEvent<HTMLElement>): void => {\r\n    if (this.selectedItemsList.current) {\r\n      // Pass it down into the selected items list\r\n      this.selectedItemsList.current.onCopy(ev);\r\n    }\r\n  };\r\n\r\n  protected onPaste = (ev: React.ClipboardEvent<Autofill | HTMLInputElement>): void => {\r\n    if (this.props.onPaste) {\r\n      const inputText = ev.clipboardData.getData('Text');\r\n      ev.preventDefault();\r\n      this.props.onPaste(inputText);\r\n    }\r\n  };\r\n\r\n  protected _onSuggestionSelected = (item: T): void => {\r\n    const currentRenderedQueryString = this.props.currentRenderedQueryString;\r\n    const queryString = this.state.queryString;\r\n    if (currentRenderedQueryString === undefined || currentRenderedQueryString === queryString) {\r\n      const processedItem: T | PromiseLike<T> | null = this.props.onItemSelected ? (this.props.onItemSelected as any)(item) : item;\r\n\r\n      if (processedItem === null) {\r\n        return;\r\n      }\r\n\r\n      const processedItemObject: T = processedItem as T;\r\n      const processedItemPromiseLike: PromiseLike<T> = processedItem as PromiseLike<T>;\r\n\r\n      let newItem: T;\r\n      if (processedItemPromiseLike && processedItemPromiseLike.then) {\r\n        processedItemPromiseLike.then((resolvedProcessedItem: T) => {\r\n          newItem = resolvedProcessedItem;\r\n          this._addProcessedItem(newItem);\r\n        });\r\n      } else {\r\n        newItem = processedItemObject;\r\n        this._addProcessedItem(newItem);\r\n      }\r\n    }\r\n  };\r\n\r\n  protected _onSelectedItemsChanged = (): void => {\r\n    this.focus();\r\n  };\r\n\r\n  private _addProcessedItem(newItem: T) {\r\n    // If this is a controlled component, call the on item selected callback\r\n    // Otherwise add it to the selectedItemsList\r\n    if (this.props.onItemAdded) {\r\n      this.props.onItemAdded(newItem);\r\n    }\r\n\r\n    if (this.selectedItemsList.current) {\r\n      this.selectedItemsList.current.addItems([newItem]);\r\n    }\r\n\r\n    if (this.input.current) {\r\n      this.input.current.clear();\r\n    }\r\n\r\n    if (this.floatingPicker.current) {\r\n      this.floatingPicker.current.hidePicker();\r\n    }\r\n\r\n    this.focus();\r\n  }\r\n}\r\n"]}