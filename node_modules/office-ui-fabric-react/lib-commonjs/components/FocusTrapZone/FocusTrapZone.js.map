{"version":3,"file":"FocusTrapZone.js","sourceRoot":"../src/","sources":["components/FocusTrapZone/FocusTrapZone.tsx"],"names":[],"mappings":"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","sourcesContent":["import * as React from 'react';\r\nimport {\r\n  elementContains,\r\n  getNativeProps,\r\n  divProperties,\r\n  getFirstTabbable,\r\n  getLastTabbable,\r\n  getNextElement,\r\n  focusAsync,\r\n  initializeComponentRef,\r\n  on\r\n} from '../../Utilities';\r\nimport { IFocusTrapZone, IFocusTrapZoneProps } from './FocusTrapZone.types';\r\n\r\nexport class FocusTrapZone extends React.Component<IFocusTrapZoneProps, {}> implements IFocusTrapZone {\r\n  private static _focusStack: FocusTrapZone[] = [];\r\n\r\n  private _root = React.createRef<HTMLDivElement>();\r\n  private _firstBumper = React.createRef<HTMLDivElement>();\r\n  private _lastBumper = React.createRef<HTMLDivElement>();\r\n  private _hasFocus: boolean = false;\r\n\r\n  private _previouslyFocusedElementOutsideTrapZone: HTMLElement;\r\n  private _previouslyFocusedElementInTrapZone?: HTMLElement;\r\n  private _disposeFocusHandler: (() => void) | undefined;\r\n  private _disposeClickHandler: (() => void) | undefined;\r\n\r\n  public constructor(props: IFocusTrapZoneProps) {\r\n    super(props);\r\n    initializeComponentRef(this);\r\n  }\r\n\r\n  public componentDidMount(): void {\r\n    this._bringFocusIntoZone();\r\n    this._updateEventHandlers(this.props);\r\n  }\r\n\r\n  public componentWillReceiveProps(nextProps: IFocusTrapZoneProps): void {\r\n    const { elementToFocusOnDismiss } = nextProps;\r\n    if (elementToFocusOnDismiss && this._previouslyFocusedElementOutsideTrapZone !== elementToFocusOnDismiss) {\r\n      this._previouslyFocusedElementOutsideTrapZone = elementToFocusOnDismiss;\r\n    }\r\n\r\n    this._updateEventHandlers(nextProps);\r\n  }\r\n\r\n  public componentDidUpdate(prevProps: IFocusTrapZoneProps) {\r\n    const prevForceFocusInsideTrap = prevProps.forceFocusInsideTrap !== undefined ? prevProps.forceFocusInsideTrap : true;\r\n    const newForceFocusInsideTrap = this.props.forceFocusInsideTrap !== undefined ? this.props.forceFocusInsideTrap : true;\r\n\r\n    if (!prevForceFocusInsideTrap && newForceFocusInsideTrap) {\r\n      // Transition from forceFocusInsideTrap disabled to enabled. Emulate what happens when a FocusTrapZone gets mounted\r\n      this._bringFocusIntoZone();\r\n    } else if (prevForceFocusInsideTrap && !newForceFocusInsideTrap) {\r\n      // Transition from forceFocusInsideTrap enabled to disabled. Emulate what happens when a FocusTrapZone gets unmounted\r\n      this._returnFocusToInitiator();\r\n    }\r\n  }\r\n\r\n  public componentWillUnmount(): void {\r\n    this._returnFocusToInitiator();\r\n  }\r\n\r\n  public render(): JSX.Element {\r\n    const { className, ariaLabelledBy } = this.props;\r\n    const divProps = getNativeProps(this.props, divProperties);\r\n\r\n    const bumperProps = {\r\n      style: {\r\n        pointerEvents: 'none',\r\n        position: 'fixed' // 'fixed' prevents browsers from scrolling to bumpers when viewport does not contain them\r\n      },\r\n      tabIndex: 0,\r\n      'aria-hidden': true,\r\n      'data-is-visible': true\r\n    } as React.HTMLAttributes<HTMLDivElement>;\r\n\r\n    return (\r\n      <div\r\n        {...divProps}\r\n        className={className}\r\n        ref={this._root}\r\n        aria-labelledby={ariaLabelledBy}\r\n        onFocusCapture={this._onFocusCapture}\r\n        onFocus={this._onRootFocus}\r\n        onBlur={this._onRootBlur}\r\n      >\r\n        <div {...bumperProps} ref={this._firstBumper} onFocus={this._onFirstBumperFocus} />\r\n        {this.props.children}\r\n        <div {...bumperProps} ref={this._lastBumper} onFocus={this._onLastBumperFocus} />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  public focus() {\r\n    const { focusPreviouslyFocusedInnerElement, firstFocusableSelector } = this.props;\r\n\r\n    if (\r\n      focusPreviouslyFocusedInnerElement &&\r\n      this._previouslyFocusedElementInTrapZone &&\r\n      elementContains(this._root.current, this._previouslyFocusedElementInTrapZone)\r\n    ) {\r\n      // focus on the last item that had focus in the zone before we left the zone\r\n      this._focusAsync(this._previouslyFocusedElementInTrapZone);\r\n      return;\r\n    }\r\n\r\n    const focusSelector =\r\n      typeof firstFocusableSelector === 'string' ? firstFocusableSelector : firstFocusableSelector && firstFocusableSelector();\r\n\r\n    let _firstFocusableChild;\r\n\r\n    if (this._root.current) {\r\n      if (focusSelector) {\r\n        _firstFocusableChild = this._root.current.querySelector('.' + focusSelector);\r\n      }\r\n\r\n      // Fall back to first element if query selector did not match any elements.\r\n      if (!_firstFocusableChild) {\r\n        _firstFocusableChild = getNextElement(this._root.current, this._root.current.firstChild as HTMLElement, false, false, false, true);\r\n      }\r\n    }\r\n    if (_firstFocusableChild) {\r\n      this._focusAsync(_firstFocusableChild);\r\n    }\r\n  }\r\n\r\n  private _focusAsync(element: HTMLElement): void {\r\n    if (!this._isBumper(element)) {\r\n      focusAsync(element);\r\n    }\r\n  }\r\n\r\n  private _onRootFocus = (ev: React.FocusEvent<HTMLDivElement>) => {\r\n    if (this.props.onFocus) {\r\n      this.props.onFocus(ev);\r\n    }\r\n\r\n    this._hasFocus = true;\r\n  };\r\n\r\n  private _onRootBlur = (ev: React.FocusEvent<HTMLDivElement>) => {\r\n    if (this.props.onBlur) {\r\n      this.props.onBlur(ev);\r\n    }\r\n\r\n    let relatedTarget = ev.relatedTarget;\r\n    if (ev.relatedTarget === null) {\r\n      // In IE11, due to lack of support, event.relatedTarget is always\r\n      // null making every onBlur call to be \"outside\" of the ComboBox\r\n      // even when it's not. Using document.activeElement is another way\r\n      // for us to be able to get what the relatedTarget without relying\r\n      // on the event\r\n      relatedTarget = document.activeElement as Element;\r\n    }\r\n\r\n    if (!elementContains(this._root.current, relatedTarget as HTMLElement)) {\r\n      this._hasFocus = false;\r\n    }\r\n  };\r\n\r\n  private _onFirstBumperFocus = () => {\r\n    this._onBumperFocus(true);\r\n  };\r\n\r\n  private _onLastBumperFocus = () => {\r\n    this._onBumperFocus(false);\r\n  };\r\n\r\n  private _onBumperFocus = (isFirstBumper: boolean) => {\r\n    const currentBumper = (isFirstBumper === this._hasFocus ? this._lastBumper.current : this._firstBumper.current) as HTMLElement;\r\n    if (this._root.current) {\r\n      const nextFocusable =\r\n        isFirstBumper === this._hasFocus\r\n          ? getLastTabbable(this._root.current, currentBumper, true, false)\r\n          : getFirstTabbable(this._root.current, currentBumper, true, false);\r\n\r\n      if (nextFocusable) {\r\n        if (this._isBumper(nextFocusable)) {\r\n          // This can happen when FTZ contains no tabbable elements. focus will take care of finding a focusable element in FTZ.\r\n          this.focus();\r\n        } else {\r\n          nextFocusable.focus();\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  private _bringFocusIntoZone(): void {\r\n    const { elementToFocusOnDismiss, disableFirstFocus = false } = this.props;\r\n\r\n    FocusTrapZone._focusStack.push(this);\r\n\r\n    this._previouslyFocusedElementOutsideTrapZone = elementToFocusOnDismiss\r\n      ? elementToFocusOnDismiss\r\n      : (document.activeElement as HTMLElement);\r\n    if (!disableFirstFocus && !elementContains(this._root.current, this._previouslyFocusedElementOutsideTrapZone)) {\r\n      this.focus();\r\n    }\r\n  }\r\n\r\n  private _returnFocusToInitiator(): void {\r\n    const { ignoreExternalFocusing } = this.props;\r\n\r\n    FocusTrapZone._focusStack = FocusTrapZone._focusStack.filter((value: FocusTrapZone) => {\r\n      return this !== value;\r\n    });\r\n\r\n    const activeElement = document.activeElement as HTMLElement;\r\n    if (\r\n      !ignoreExternalFocusing &&\r\n      this._previouslyFocusedElementOutsideTrapZone &&\r\n      typeof this._previouslyFocusedElementOutsideTrapZone.focus === 'function' &&\r\n      (elementContains(this._root.current, activeElement) || activeElement === document.body)\r\n    ) {\r\n      this._focusAsync(this._previouslyFocusedElementOutsideTrapZone);\r\n    }\r\n  }\r\n\r\n  private _updateEventHandlers(newProps: IFocusTrapZoneProps): void {\r\n    const { isClickableOutsideFocusTrap = false, forceFocusInsideTrap = true } = newProps;\r\n\r\n    if (forceFocusInsideTrap && !this._disposeFocusHandler) {\r\n      this._disposeFocusHandler = on(window, 'focus', this._forceFocusInTrap, true);\r\n    } else if (!forceFocusInsideTrap && this._disposeFocusHandler) {\r\n      this._disposeFocusHandler();\r\n      this._disposeFocusHandler = undefined;\r\n    }\r\n\r\n    if (!isClickableOutsideFocusTrap && !this._disposeClickHandler) {\r\n      this._disposeClickHandler = on(window, 'click', this._forceClickInTrap, true);\r\n    } else if (isClickableOutsideFocusTrap && this._disposeClickHandler) {\r\n      this._disposeClickHandler();\r\n      this._disposeClickHandler = undefined;\r\n    }\r\n  }\r\n\r\n  private _onFocusCapture = (ev: React.FocusEvent<HTMLDivElement>) => {\r\n    if (this.props.onFocusCapture) {\r\n      this.props.onFocusCapture(ev);\r\n    }\r\n\r\n    if (ev.target !== ev.currentTarget && !this._isBumper(ev.target)) {\r\n      // every time focus changes within the trap zone, remember the focused element so that\r\n      // it can be restored if focus leaves the pane and returns via keystroke (i.e. via a call to this.focus(true))\r\n      this._previouslyFocusedElementInTrapZone = ev.target as HTMLElement;\r\n    }\r\n  };\r\n\r\n  private _isBumper(element: HTMLElement): boolean {\r\n    return element === this._firstBumper.current || element === this._lastBumper.current;\r\n  }\r\n\r\n  private _forceFocusInTrap = (ev: FocusEvent): void => {\r\n    if (FocusTrapZone._focusStack.length && this === FocusTrapZone._focusStack[FocusTrapZone._focusStack.length - 1]) {\r\n      const focusedElement = document.activeElement as HTMLElement;\r\n\r\n      if (!elementContains(this._root.current, focusedElement)) {\r\n        this.focus();\r\n        this._hasFocus = true; // set focus here since we stop event propagation\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n      }\r\n    }\r\n  };\r\n\r\n  private _forceClickInTrap = (ev: MouseEvent): void => {\r\n    if (FocusTrapZone._focusStack.length && this === FocusTrapZone._focusStack[FocusTrapZone._focusStack.length - 1]) {\r\n      const clickedElement = ev.target as HTMLElement;\r\n\r\n      if (clickedElement && !elementContains(this._root.current, clickedElement)) {\r\n        this.focus();\r\n        this._hasFocus = true; // set focus here since we stop event propagation\r\n        ev.preventDefault();\r\n        ev.stopPropagation();\r\n      }\r\n    }\r\n  };\r\n}\r\n"]}