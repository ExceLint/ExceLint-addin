{"version":3,"file":"AutoScroll.js","sourceRoot":"../src/","sources":["AutoScroll.ts"],"names":[],"mappings":";;;IAOA,IAAM,sBAAsB,GAAG,EAAE,CAAC;IAClC,IAAM,oBAAoB,GAAG,GAAG,CAAC;IACjC,IAAM,mBAAmB,GAAG,EAAE,CAAC;IAE/B;;;;;;;OAOG;IACH;QAOE,oBAAY,OAAoB;YAC9B,IAAI,CAAC,OAAO,GAAG,IAAI,uBAAU,CAAC,IAAI,CAAC,CAAC;YACpC,IAAI,CAAC,iBAAiB,GAAG,6BAAoB,CAAC,OAAO,CAAC,CAAC;YAEvD,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC,gBAAgB,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACzD,IAAI,CAAC,WAAW,GAAG,iBAAO,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAEnD,kCAAkC;YAClC,IAAI,IAAI,CAAC,iBAAiB,KAAM,MAAc,EAAE;gBAC9C,IAAI,CAAC,iBAAiB,GAAG,QAAQ,CAAC,IAAI,CAAC;aACxC;YAED,IAAI,IAAI,CAAC,iBAAiB,EAAE;gBAC1B,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;gBAC9D,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,MAAM,EAAE,WAAW,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,CAAC;aAC/D;QACH,CAAC;QAEM,4BAAO,GAAd;YACE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;YACvB,IAAI,CAAC,WAAW,EAAE,CAAC;QACrB,CAAC;QAEO,iCAAY,GAApB,UAAqB,EAAc;YACjC,IAAI,CAAC,sBAAsB,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC;QAC1C,CAAC;QAEO,iCAAY,GAApB,UAAqB,EAAc;YACjC,IAAI,EAAE,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE;gBACzB,IAAI,CAAC,sBAAsB,CAAC,EAAE,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC;aACpD;QACH,CAAC;QAEO,2CAAsB,GAA9B,UAA+B,OAAe;YAC5C,IAAI,CAAC,IAAI,CAAC,WAAW,EAAE;gBACrB,OAAO;aACR;YAED,IAAI,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC,GAAG,CAAC;YACzC,IAAI,kBAAkB,GAAG,aAAa,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,GAAG,oBAAoB,CAAC;YAExF,IAAI,OAAO,GAAG,aAAa,GAAG,oBAAoB,EAAE;gBAClD,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,GAAG,CAC7B,CAAC,mBAAmB,EACpB,CAAC,mBAAmB,GAAG,CAAC,CAAC,oBAAoB,GAAG,CAAC,OAAO,GAAG,aAAa,CAAC,CAAC,GAAG,oBAAoB,CAAC,CACnG,CAAC;aACH;iBAAM,IAAI,OAAO,GAAG,kBAAkB,EAAE;gBACvC,IAAI,CAAC,eAAe,GAAG,IAAI,CAAC,GAAG,CAAC,mBAAmB,EAAE,mBAAmB,GAAG,CAAC,CAAC,OAAO,GAAG,kBAAkB,CAAC,GAAG,oBAAoB,CAAC,CAAC,CAAC;aACrI;iBAAM;gBACL,IAAI,CAAC,eAAe,GAAG,CAAC,CAAC;aAC1B;YAED,IAAI,IAAI,CAAC,eAAe,EAAE;gBACxB,IAAI,CAAC,YAAY,EAAE,CAAC;aACrB;iBAAM;gBACL,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;QACH,CAAC;QAEO,iCAAY,GAApB;YACE,IAAI,CAAC,IAAI,CAAC,UAAU,EAAE;gBACpB,IAAI,CAAC,gBAAgB,EAAE,CAAC;aACzB;QACH,CAAC;QAEO,qCAAgB,GAAxB;YACE,IAAI,IAAI,CAAC,iBAAiB,EAAE;gBAC1B,IAAI,CAAC,iBAAiB,CAAC,SAAS,IAAI,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;aACtE;YAED,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,IAAI,CAAC,gBAAgB,EAAE,sBAAsB,CAAC,CAAC;QAC9E,CAAC;QAEO,gCAAW,GAAnB;YACE,IAAI,IAAI,CAAC,UAAU,EAAE;gBACnB,YAAY,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC;gBAC9B,OAAO,IAAI,CAAC,UAAU,CAAC;aACxB;QACH,CAAC;QACH,iBAAC;IAAD,CAAC,AAtFD,IAsFC;IAtFY,gCAAU","sourcesContent":["import { EventGroup } from './EventGroup';\r\nimport { findScrollableParent } from './scroll';\r\nimport { getRect } from './dom/getRect';\r\nimport { IRectangle } from './IRectangle';\r\n\r\ndeclare function setTimeout(cb: Function, delay: number): number;\r\n\r\nconst SCROLL_ITERATION_DELAY = 16;\r\nconst SCROLL_GUTTER_HEIGHT = 100;\r\nconst MAX_SCROLL_VELOCITY = 15;\r\n\r\n/**\r\n * AutoScroll simply hooks up mouse events given a parent element, and scrolls the container\r\n * up/down depending on how close the mouse is to the top/bottom of the container.\r\n *\r\n * Once you don't want autoscroll any more, just dispose the helper and it will unhook events.\r\n *\r\n * @public\r\n */\r\nexport class AutoScroll {\r\n  private _events: EventGroup;\r\n  private _scrollableParent: HTMLElement | null;\r\n  private _scrollRect: IRectangle | undefined;\r\n  private _scrollVelocity: number;\r\n  private _timeoutId: number;\r\n\r\n  constructor(element: HTMLElement) {\r\n    this._events = new EventGroup(this);\r\n    this._scrollableParent = findScrollableParent(element);\r\n\r\n    this._incrementScroll = this._incrementScroll.bind(this);\r\n    this._scrollRect = getRect(this._scrollableParent);\r\n\r\n    // tslint:disable-next-line:no-any\r\n    if (this._scrollableParent === (window as any)) {\r\n      this._scrollableParent = document.body;\r\n    }\r\n\r\n    if (this._scrollableParent) {\r\n      this._events.on(window, 'mousemove', this._onMouseMove, true);\r\n      this._events.on(window, 'touchmove', this._onTouchMove, true);\r\n    }\r\n  }\r\n\r\n  public dispose(): void {\r\n    this._events.dispose();\r\n    this._stopScroll();\r\n  }\r\n\r\n  private _onMouseMove(ev: MouseEvent): void {\r\n    this._computeScrollVelocity(ev.clientY);\r\n  }\r\n\r\n  private _onTouchMove(ev: TouchEvent): void {\r\n    if (ev.touches.length > 0) {\r\n      this._computeScrollVelocity(ev.touches[0].clientY);\r\n    }\r\n  }\r\n\r\n  private _computeScrollVelocity(clientY: number): void {\r\n    if (!this._scrollRect) {\r\n      return;\r\n    }\r\n\r\n    let scrollRectTop = this._scrollRect.top;\r\n    let scrollClientBottom = scrollRectTop + this._scrollRect.height - SCROLL_GUTTER_HEIGHT;\r\n\r\n    if (clientY < scrollRectTop + SCROLL_GUTTER_HEIGHT) {\r\n      this._scrollVelocity = Math.max(\r\n        -MAX_SCROLL_VELOCITY,\r\n        -MAX_SCROLL_VELOCITY * ((SCROLL_GUTTER_HEIGHT - (clientY - scrollRectTop)) / SCROLL_GUTTER_HEIGHT)\r\n      );\r\n    } else if (clientY > scrollClientBottom) {\r\n      this._scrollVelocity = Math.min(MAX_SCROLL_VELOCITY, MAX_SCROLL_VELOCITY * ((clientY - scrollClientBottom) / SCROLL_GUTTER_HEIGHT));\r\n    } else {\r\n      this._scrollVelocity = 0;\r\n    }\r\n\r\n    if (this._scrollVelocity) {\r\n      this._startScroll();\r\n    } else {\r\n      this._stopScroll();\r\n    }\r\n  }\r\n\r\n  private _startScroll(): void {\r\n    if (!this._timeoutId) {\r\n      this._incrementScroll();\r\n    }\r\n  }\r\n\r\n  private _incrementScroll(): void {\r\n    if (this._scrollableParent) {\r\n      this._scrollableParent.scrollTop += Math.round(this._scrollVelocity);\r\n    }\r\n\r\n    this._timeoutId = setTimeout(this._incrementScroll, SCROLL_ITERATION_DELAY);\r\n  }\r\n\r\n  private _stopScroll(): void {\r\n    if (this._timeoutId) {\r\n      clearTimeout(this._timeoutId);\r\n      delete this._timeoutId;\r\n    }\r\n  }\r\n}\r\n"]}