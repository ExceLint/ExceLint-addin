{"version":3,"file":"EventGroup.js","sourceRoot":"../src/","sources":["EventGroup.ts"],"names":[],"mappings":"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","sourcesContent":["/* tslint:disable:no-string-literal */\r\nimport { assign } from './object';\r\n\r\n/**\r\n * EventRecord interface.\r\n *\r\n * @internal\r\n */\r\n// tslint:disable:no-any\r\nexport interface IEventRecord {\r\n  target: any;\r\n  eventName: string;\r\n  parent: any;\r\n  callback: (args?: any) => void;\r\n  elementCallback?: (...args: any[]) => void;\r\n  objectCallback?: (args?: any) => void;\r\n  options?: boolean | AddEventListenerOptions;\r\n}\r\n// tslint:enable:no-any\r\n\r\n/**\r\n * EventRecordsByName interface.\r\n *\r\n * @internal\r\n */\r\nexport interface IEventRecordsByName {\r\n  [eventName: string]: IEventRecordList;\r\n}\r\n\r\n/**\r\n * EventRecordList interface.\r\n *\r\n * @internal\r\n */\r\nexport interface IEventRecordList {\r\n  [id: string]: IEventRecord[] | number;\r\n  count: number;\r\n}\r\n\r\n/**\r\n * DeclaredEventsByName interface.\r\n *\r\n * @internal\r\n */\r\nexport interface IDeclaredEventsByName {\r\n  [eventName: string]: boolean;\r\n}\r\n\r\n/** An instance of EventGroup allows anything with a handle to it to trigger events on it.\r\n *  If the target is an HTMLElement, the event will be attached to the element and can be\r\n *  triggered as usual (like clicking for onclick).\r\n *  The event can be triggered by calling EventGroup.raise() here. If the target is an\r\n *  HTMLElement, the event gets raised and is handled by the browser. Otherwise, it gets\r\n *  handled here in EventGroup, and the handler is called in the context of the parent\r\n *  (which is passed in in the constructor).\r\n *\r\n * @public\r\n */\r\nexport class EventGroup {\r\n  // tslint:disable-next-line:no-inferrable-types\r\n  private static _uniqueId: number = 0;\r\n  // tslint:disable-next-line:no-any\r\n  private _parent: any;\r\n  private _eventRecords: IEventRecord[];\r\n  private _id: number = EventGroup._uniqueId++;\r\n  private _isDisposed: boolean;\r\n\r\n  /** For IE8, bubbleEvent is ignored here and must be dealt with by the handler.\r\n   *  Events raised here by default have bubbling set to false and cancelable set to true.\r\n   *  This applies also to built-in events being raised manually here on HTMLElements,\r\n   *  which may lead to unexpected behavior if it differs from the defaults.\r\n   *\r\n   */\r\n  public static raise(\r\n    // tslint:disable-next-line:no-any\r\n    target: any,\r\n    eventName: string,\r\n    // tslint:disable-next-line:no-any\r\n    eventArgs?: any,\r\n    bubbleEvent?: boolean\r\n  ): boolean | undefined {\r\n    let retVal;\r\n\r\n    if (EventGroup._isElement(target)) {\r\n      if (document.createEvent) {\r\n        let ev = document.createEvent('HTMLEvents');\r\n\r\n        ev.initEvent(eventName, bubbleEvent || false, true);\r\n\r\n        assign(ev, eventArgs);\r\n\r\n        retVal = target.dispatchEvent(ev);\r\n        // tslint:disable-next-line:no-any\r\n      } else if ((document as any)['createEventObject']) {\r\n        // IE8\r\n        // tslint:disable-next-line:no-any\r\n        let evObj = (document as any)['createEventObject'](eventArgs);\r\n        // cannot set cancelBubble on evObj, fireEvent will overwrite it\r\n        target.fireEvent('on' + eventName, evObj);\r\n      }\r\n    } else {\r\n      while (target && retVal !== false) {\r\n        let events = <IEventRecordsByName>target.__events__;\r\n        let eventRecords = events ? events[eventName] : null;\r\n\r\n        if (eventRecords) {\r\n          for (let id in eventRecords) {\r\n            if (eventRecords.hasOwnProperty(id)) {\r\n              let eventRecordList = <IEventRecord[]>eventRecords[id];\r\n\r\n              for (let listIndex = 0; retVal !== false && listIndex < eventRecordList.length; listIndex++) {\r\n                let record = eventRecordList[listIndex];\r\n\r\n                if (record.objectCallback) {\r\n                  retVal = record.objectCallback.call(record.parent, eventArgs);\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // If the target has a parent, bubble the event up.\r\n        target = bubbleEvent ? target.parent : null;\r\n      }\r\n    }\r\n\r\n    return retVal;\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public static isObserved(target: any, eventName: string): boolean {\r\n    let events = target && <IEventRecordsByName>target.__events__;\r\n\r\n    return !!events && !!events[eventName];\r\n  }\r\n\r\n  /** Check to see if the target has declared support of the given event. */\r\n  // tslint:disable-next-line:no-any\r\n  public static isDeclared(target: any, eventName: string): boolean {\r\n    let declaredEvents = target && <IDeclaredEventsByName>target.__declaredEvents;\r\n\r\n    return !!declaredEvents && !!declaredEvents[eventName];\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public static stopPropagation(event: any): void {\r\n    if (event.stopPropagation) {\r\n      event.stopPropagation();\r\n    } else {\r\n      // IE8\r\n      event.cancelBubble = true;\r\n    }\r\n  }\r\n\r\n  private static _isElement(target: HTMLElement): boolean {\r\n    return !!target && (!!target.addEventListener || (typeof HTMLElement !== 'undefined' && target instanceof HTMLElement));\r\n  }\r\n\r\n  /** parent: the context in which events attached to non-HTMLElements are called */\r\n  // tslint:disable-next-line:no-any\r\n  public constructor(parent: any) {\r\n    this._parent = parent;\r\n    this._eventRecords = [];\r\n  }\r\n\r\n  public dispose(): void {\r\n    if (!this._isDisposed) {\r\n      this._isDisposed = true;\r\n\r\n      this.off();\r\n      this._parent = null;\r\n    }\r\n  }\r\n\r\n  /** On the target, attach a set of events, where the events object is a name to function mapping. */\r\n  // tslint:disable-next-line:no-any\r\n  public onAll(target: any, events: { [key: string]: (args?: any) => void }, useCapture?: boolean): void {\r\n    for (let eventName in events) {\r\n      if (events.hasOwnProperty(eventName)) {\r\n        this.on(target, eventName, events[eventName], useCapture);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** On the target, attach an event whose handler will be called in the context of the parent\r\n   * of this instance of EventGroup.\r\n   */\r\n  // tslint:disable-next-line:no-any\r\n  public on(target: any, eventName: string, callback: (args?: any) => void, options?: boolean | AddEventListenerOptions): void {\r\n    if (eventName.indexOf(',') > -1) {\r\n      let events = eventName.split(/[ ,]+/);\r\n\r\n      for (let i = 0; i < events.length; i++) {\r\n        this.on(target, events[i], callback, options);\r\n      }\r\n    } else {\r\n      let parent = this._parent;\r\n      let eventRecord: IEventRecord = {\r\n        target: target,\r\n        eventName: eventName,\r\n        parent: parent,\r\n        callback: callback,\r\n        options\r\n      };\r\n\r\n      // Initialize and wire up the record on the target, so that it can call the callback if the event fires.\r\n      let events = <IEventRecordsByName>(target.__events__ = target.__events__ || {});\r\n      events[eventName] =\r\n        events[eventName] ||\r\n        <IEventRecordList>{\r\n          count: 0\r\n        };\r\n      events[eventName][this._id] = events[eventName][this._id] || [];\r\n      (<IEventRecord[]>events[eventName][this._id]).push(eventRecord);\r\n      events[eventName].count++;\r\n\r\n      if (EventGroup._isElement(target)) {\r\n        // tslint:disable-next-line:no-any\r\n        let processElementEvent = (...args: any[]) => {\r\n          if (this._isDisposed) {\r\n            return;\r\n          }\r\n\r\n          let result;\r\n          try {\r\n            result = callback.apply(parent, args);\r\n            if (result === false && args[0]) {\r\n              let e = args[0];\r\n\r\n              if (e.preventDefault) {\r\n                e.preventDefault();\r\n              }\r\n\r\n              if (e.stopPropagation) {\r\n                e.stopPropagation();\r\n              }\r\n\r\n              e.cancelBubble = true;\r\n            }\r\n          } catch (e) {\r\n            /* ErrorHelper.log(e); */\r\n          }\r\n\r\n          return result;\r\n        };\r\n\r\n        eventRecord.elementCallback = processElementEvent;\r\n\r\n        if (target.addEventListener) {\r\n          /* tslint:disable:ban-native-functions */\r\n          (<EventTarget>target).addEventListener(eventName, processElementEvent, options);\r\n          /* tslint:enable:ban-native-functions */\r\n        } else if (target.attachEvent) {\r\n          // IE8\r\n          target.attachEvent('on' + eventName, processElementEvent);\r\n        }\r\n      } else {\r\n        // tslint:disable-next-line:no-any\r\n        let processObjectEvent = (...args: any[]) => {\r\n          if (this._isDisposed) {\r\n            return;\r\n          }\r\n\r\n          return callback.apply(parent, args);\r\n        };\r\n\r\n        eventRecord.objectCallback = processObjectEvent;\r\n      }\r\n\r\n      // Remember the record locally, so that it can be removed.\r\n      this._eventRecords.push(eventRecord);\r\n    }\r\n  }\r\n\r\n  // tslint:disable-next-line:no-any\r\n  public off(target?: any, eventName?: string, callback?: (args?: any) => void, options?: boolean | AddEventListenerOptions): void {\r\n    for (let i = 0; i < this._eventRecords.length; i++) {\r\n      let eventRecord = this._eventRecords[i];\r\n      if (\r\n        (!target || target === eventRecord.target) &&\r\n        (!eventName || eventName === eventRecord.eventName) &&\r\n        (!callback || callback === eventRecord.callback) &&\r\n        (typeof options !== 'boolean' || options === eventRecord.options)\r\n      ) {\r\n        let events = <IEventRecordsByName>eventRecord.target.__events__;\r\n        let targetArrayLookup = events[eventRecord.eventName];\r\n        let targetArray = targetArrayLookup ? <IEventRecord[]>targetArrayLookup[this._id] : null;\r\n\r\n        // We may have already target's entries, so check for null.\r\n        if (targetArray) {\r\n          if (targetArray.length === 1 || !callback) {\r\n            targetArrayLookup.count -= targetArray.length;\r\n            delete events[eventRecord.eventName][this._id];\r\n          } else {\r\n            targetArrayLookup.count--;\r\n            targetArray.splice(targetArray.indexOf(eventRecord), 1);\r\n          }\r\n\r\n          if (!targetArrayLookup.count) {\r\n            delete events[eventRecord.eventName];\r\n          }\r\n        }\r\n\r\n        if (eventRecord.elementCallback) {\r\n          if (eventRecord.target.removeEventListener) {\r\n            eventRecord.target.removeEventListener(eventRecord.eventName, eventRecord.elementCallback, eventRecord.options);\r\n          } else if (eventRecord.target.detachEvent) {\r\n            // IE8\r\n            eventRecord.target.detachEvent('on' + eventRecord.eventName, eventRecord.elementCallback);\r\n          }\r\n        }\r\n\r\n        this._eventRecords.splice(i--, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  /** Trigger the given event in the context of this instance of EventGroup. */\r\n  // tslint:disable-next-line:no-any\r\n  public raise(eventName: string, eventArgs?: any, bubbleEvent?: boolean): boolean | undefined {\r\n    return EventGroup.raise(this._parent, eventName, eventArgs, bubbleEvent);\r\n  }\r\n\r\n  /** Declare an event as being supported by this instance of EventGroup. */\r\n  public declare(event: string | string[]): void {\r\n    let declaredEvents = (this._parent.__declaredEvents = this._parent.__declaredEvents || {});\r\n\r\n    if (typeof event === 'string') {\r\n      declaredEvents[event] = true;\r\n    } else {\r\n      for (let i = 0; i < event.length; i++) {\r\n        declaredEvents[event[i]] = true;\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}