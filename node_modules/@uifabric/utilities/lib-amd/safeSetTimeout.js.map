{"version":3,"file":"safeSetTimeout.js","sourceRoot":"../src/","sources":["safeSetTimeout.ts"],"names":[],"mappings":";;;IAGA;;;;;OAKG;IACU,QAAA,cAAc,GAAG,UAAC,SAA0B;QACvD,IAAI,cAAiC,CAAC;QAEtC,OAAO,UAAC,EAAY,EAAE,QAAgB;YACpC,IAAI,CAAC,cAAc,EAAE;gBACnB,cAAc,GAAG,IAAI,GAAG,EAAgB,CAAC;gBAEzC,iCAAe,CAAC,SAAS,EAAE;oBACzB,oBAAoB,EAAE;wBACpB,cAAc,CAAC,OAAO,CAAC,UAAC,EAAgB,IAAK,OAAA,YAAY,CAAC,EAAE,CAAC,EAAhB,CAAgB,CAAC,CAAC;oBACjE,CAAC;iBACF,CAAC,CAAC;aACJ;YAED,IAAM,SAAS,GAAG,UAAU,CAAC;gBAC3B,cAAc,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;gBACjC,EAAE,EAAE,CAAC;YACP,CAAC,EAAE,QAAQ,CAAC,CAAC;YACb,cAAc,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;QAChC,CAAC,CAAC;IACJ,CAAC,CAAC","sourcesContent":["import * as React from 'react';\r\nimport { extendComponent } from './extendComponent';\r\n\r\n/**\r\n * Generates a function to be attached to a React component, which can be called\r\n * as a replacement to setTimeout. In-flight async calls will be auto canceled if the component\r\n * is unmounting before the async code is executed, preventing bugs where code\r\n * accesses things within the component after being unmounted.\r\n */\r\nexport const safeSetTimeout = (component: React.Component) => {\r\n  let activeTimeouts: Set<NodeJS.Timer>;\r\n\r\n  return (cb: Function, duration: number) => {\r\n    if (!activeTimeouts) {\r\n      activeTimeouts = new Set<NodeJS.Timer>();\r\n\r\n      extendComponent(component, {\r\n        componentWillUnmount: () => {\r\n          activeTimeouts.forEach((id: NodeJS.Timer) => clearTimeout(id));\r\n        },\r\n      });\r\n    }\r\n\r\n    const timeoutId = setTimeout(() => {\r\n      activeTimeouts.delete(timeoutId);\r\n      cb();\r\n    }, duration);\r\n    activeTimeouts.add(timeoutId);\r\n  };\r\n};\r\n"]}