{"version":3,"file":"scroll.js","sourceRoot":"../src/","sources":["scroll.ts"],"names":[],"mappings":"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","sourcesContent":["import { getDocument } from './dom/getDocument';\r\nimport { mergeStyles } from '@uifabric/merge-styles';\r\nimport { EventGroup } from './EventGroup';\r\n\r\nlet _scrollbarWidth: number;\r\nlet _bodyScrollDisabledCount = 0;\r\n\r\nconst DisabledScrollClassName = mergeStyles({\r\n  overflow: 'hidden !important' as 'hidden'\r\n});\r\n\r\n/**\r\n * Placing this attribute on scrollable divs optimizes detection to know\r\n * if the div is scrollable or not (given we can avoid expensive operations\r\n * like getComputedStyle.)\r\n *\r\n * @public\r\n */\r\nexport const DATA_IS_SCROLLABLE_ATTRIBUTE = 'data-is-scrollable';\r\n\r\nconst _makeElementScrollAllower = () => {\r\n  let _previousClientY = 0;\r\n  let _element: Element | null = null;\r\n\r\n  // remember the clientY for future calls of _preventOverscrolling\r\n  const _saveClientY = (event: TouchEvent): void => {\r\n    if (event.targetTouches.length === 1) {\r\n      _previousClientY = event.targetTouches[0].clientY;\r\n    }\r\n  };\r\n\r\n  // prevent the body from scrolling when the user attempts\r\n  // to scroll past the top or bottom of the element\r\n  const _preventOverscrolling = (event: TouchEvent): void => {\r\n    // only respond to a single-finger touch\r\n    if (event.targetTouches.length !== 1) {\r\n      return;\r\n    }\r\n\r\n    // prevent the body touchmove handler from firing\r\n    // so that scrolling is allowed within the element\r\n    event.stopPropagation();\r\n\r\n    if (!_element) {\r\n      return;\r\n    }\r\n\r\n    const clientY = event.targetTouches[0].clientY - _previousClientY;\r\n\r\n    const scrollableParent = findScrollableParent(event.target as HTMLElement);\r\n    if (scrollableParent) {\r\n      _element = scrollableParent;\r\n    }\r\n\r\n    // if the element is scrolled to the top,\r\n    // prevent the user from scrolling up\r\n    if (_element.scrollTop === 0 && clientY > 0) {\r\n      event.preventDefault();\r\n    }\r\n\r\n    // if the element is scrolled to the bottom,\r\n    // prevent the user from scrolling down\r\n    if (_element.scrollHeight - _element.scrollTop <= _element.clientHeight && clientY < 0) {\r\n      event.preventDefault();\r\n    }\r\n  };\r\n\r\n  return (element: HTMLElement | null, events: EventGroup): void => {\r\n    if (!element) {\r\n      return;\r\n    }\r\n\r\n    events.on(element, 'touchstart', _saveClientY, { passive: false });\r\n    events.on(element, 'touchmove', _preventOverscrolling, { passive: false });\r\n\r\n    _element = element;\r\n  };\r\n};\r\n\r\n/**\r\n * Allows the user to scroll within a element,\r\n * while preventing the user from scrolling the body\r\n */\r\nexport const allowScrollOnElement = _makeElementScrollAllower();\r\n\r\nconst _disableIosBodyScroll = (event: TouchEvent) => {\r\n  event.preventDefault();\r\n};\r\n\r\n/**\r\n * Disables the body scrolling.\r\n *\r\n * @public\r\n */\r\nexport function disableBodyScroll(): void {\r\n  let doc = getDocument();\r\n\r\n  if (doc && doc.body && !_bodyScrollDisabledCount) {\r\n    doc.body.classList.add(DisabledScrollClassName);\r\n    doc.body.addEventListener('touchmove', _disableIosBodyScroll, { passive: false, capture: false });\r\n  }\r\n\r\n  _bodyScrollDisabledCount++;\r\n}\r\n\r\n/**\r\n * Enables the body scrolling.\r\n *\r\n * @public\r\n */\r\nexport function enableBodyScroll(): void {\r\n  if (_bodyScrollDisabledCount > 0) {\r\n    let doc = getDocument();\r\n\r\n    if (doc && doc.body && _bodyScrollDisabledCount === 1) {\r\n      doc.body.classList.remove(DisabledScrollClassName);\r\n      doc.body.removeEventListener('touchmove', _disableIosBodyScroll);\r\n    }\r\n\r\n    _bodyScrollDisabledCount--;\r\n  }\r\n}\r\n\r\n/**\r\n * Calculates the width of a scrollbar for the browser/os.\r\n *\r\n * @public\r\n */\r\nexport function getScrollbarWidth(): number {\r\n  if (_scrollbarWidth === undefined) {\r\n    let scrollDiv: HTMLElement = document.createElement('div');\r\n    scrollDiv.style.setProperty('width', '100px');\r\n    scrollDiv.style.setProperty('height', '100px');\r\n    scrollDiv.style.setProperty('overflow', 'scroll');\r\n    scrollDiv.style.setProperty('position', 'absolute');\r\n    scrollDiv.style.setProperty('top', '-9999px');\r\n    document.body.appendChild(scrollDiv);\r\n    // Get the scrollbar width\r\n    _scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth;\r\n\r\n    // Delete the DIV\r\n    document.body.removeChild(scrollDiv);\r\n  }\r\n\r\n  return _scrollbarWidth;\r\n}\r\n\r\n/**\r\n * Traverses up the DOM for the element with the data-is-scrollable=true attribute, or returns\r\n * document.body.\r\n *\r\n * @public\r\n */\r\nexport function findScrollableParent(startingElement: HTMLElement | null): HTMLElement | null {\r\n  let el: HTMLElement | null = startingElement;\r\n\r\n  // First do a quick scan for the scrollable attribute.\r\n  while (el && el !== document.body) {\r\n    if (el.getAttribute(DATA_IS_SCROLLABLE_ATTRIBUTE) === 'true') {\r\n      return el;\r\n    }\r\n    el = el.parentElement;\r\n  }\r\n\r\n  // If we haven't found it, the use the slower method: compute styles to evaluate if overflow is set.\r\n  el = startingElement;\r\n\r\n  while (el && el !== document.body) {\r\n    if (el.getAttribute(DATA_IS_SCROLLABLE_ATTRIBUTE) !== 'false') {\r\n      const computedStyles = getComputedStyle(el);\r\n      let overflowY = computedStyles ? computedStyles.getPropertyValue('overflow-y') : '';\r\n\r\n      if (overflowY && (overflowY === 'scroll' || overflowY === 'auto')) {\r\n        return el;\r\n      }\r\n    }\r\n\r\n    el = el.parentElement;\r\n  }\r\n\r\n  // Fall back to window scroll.\r\n  if (!el || el === document.body) {\r\n    // tslint:disable-next-line:no-any\r\n    el = window as any;\r\n  }\r\n\r\n  return el;\r\n}\r\n"]}